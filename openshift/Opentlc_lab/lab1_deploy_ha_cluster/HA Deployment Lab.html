<!DOCTYPE html>
<!-- saved from url=(0089)https://www.opentlc.com/labs/ocp_advanced_deployment/02_1_HA_Deployment_Solution_Lab.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="generator" content="Asciidoctor 0.1.4"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>HA Deployment Lab</title><style>@import url(http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.0/css/font-awesome.css);
/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, #content #toctitle, .admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .mathblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title, .tableblock > caption { line-height: 1.4; color: #003b6b; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #00579e; text-decoration: none; line-height: inherit; }
a:hover, a:focus { color: #333333; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: Arial, sans-serif; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 0.75em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: Arial, sans-serif; font-weight: normal; font-style: normal; color: #7b2d00; text-rendering: optimizeLegibility; margin-top: 0.5em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #ff6b15; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: bold; color: #003426; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 0.75em; list-style-position: outside; font-family: Arial, sans-serif; }

ul, ol { margin-left: 1.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3em; font-weight: bold; }
dl dd { margin-bottom: 0.75em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: black; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 0.75em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #e15200; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #e15200; }

blockquote, blockquote p { line-height: 1.6; color: #333333; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Print styles.  Inlined to avoid required HTTP connection: www.phpied.com/delay-loading-your-print-css/ Credit to Paul Irish and HTML5 Boilerplate (html5boilerplate.com)
*/
.print-only { display: none !important; }

@media print { * { background: transparent !important; color: #000 !important; /* Black prints faster: h5bp.com/s */ box-shadow: none !important; text-shadow: none !important; }
  a, a:visited { text-decoration: underline; }
  a[href]:after { content: " (" attr(href) ")"; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after { content: ""; }
  pre, blockquote { border: 1px solid #999; page-break-inside: avoid; }
  thead { display: table-header-group; /* h5bp.com/t */ }
  tr, img { page-break-inside: avoid; }
  img { max-width: 100% !important; }
  @page { margin: 0.5cm; }
  p, h2, h3, #toctitle, .sidebarblock > .content > .title { orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #d8d8ce; }
/* Change -webkit-linear-gradient colors to  #a70000 and remove gradient */
table thead, table tfoot { background: -webkit-linear-gradient(top, #a70000, #a70000); font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: white; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #6d6e71; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #edf2f2; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.4; }

a:hover, a:focus { text-decoration: underline; }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: inherit; padding: 3px 2px 1px 2px; white-space: nowrap; background-color: #eeeeee; border: 1px solid #dddddd; -webkit-border-radius: 0; border-radius: 0; text-shadow: none; }

pre, pre > code { line-height: 1.6; color: black; font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; }

kbd.keyseq { color: #333333; }

kbd:not(.keyseq) { display: inline-block; color: black; font-size: 0.75em; line-height: 1.4; background-color: #F7F7F7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }

kbd kbd:first-child { margin-left: 0; }

kbd kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: black; }

b.button:before { content: '[ '; }

b.button:after { content: ' ]'; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 1.5em; padding-right: 1.5em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#header { margin-bottom: 2.5em; }
#header > h1 { color: #7b2d00; font-weight: normal; border-bottom: 1px solid #dddddd; margin-bottom: -28px; padding-bottom: 32px; }
#header span { color: #333333; }
#header #revnumber { text-transform: capitalize; }
#header br { display: none; }
#header br + span { padding-left: 3px; }
#header br + span:before { content: "\2013 \0020"; }
#header br + span.author { padding-left: 0; }
#header br + span.author:before { content: ", "; }

#toc { border-bottom: 1px solid #dddddd; padding-bottom: 1.25em; }
#toc > ul { margin-left: 0.25em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
#toc ul { list-style-type: none; }

#toctitle { color: #003b6b; }

@media only screen and (min-width: 768px) { body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #dddddd; border-bottom: 0; z-index: 1000; padding: 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: .90em; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; border-width: 0; -webkit-border-radius: 0; border-radius: 0; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }
#content #toc a { text-decoration: none; }

#content #toctitle { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-size: 1em; padding-left: 0.125em; }

#footer { max-width: 100%; background-color: none; padding: 1.25em; }

#footer-text { color: black; line-height: 1.44; }

.sect1 { padding-bottom: 1.25em; }

.sect1 + .sect1 { border-top: 1px solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; width: 1em; margin-left: -1em; display: block; text-decoration: none; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: '\00A7'; font-size: .85em; vertical-align: text-top; display: block; margin-top: 0.05em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #7b2d00; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #622400; }

.imageblock, .literalblock, .listingblock, .mathblock, .verseblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .mathblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-align: left; font-weight: bold; }

.tableblock > caption { text-align: left; font-weight: bold; white-space: nowrap; overflow: visible; max-width: 0; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #333333; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6, .exampleblock > .content p { color: #333333; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6 { line-height: 1; margin-bottom: 0.625em; }
.exampleblock > .content h1.subheader, .exampleblock > .content h2.subheader, .exampleblock > .content h3.subheader, .exampleblock > .content .subheader#toctitle, .sidebarblock.exampleblock > .content > .subheader.title, .exampleblock > .content h4.subheader, .exampleblock > .content h5.subheader, .exampleblock > .content h6.subheader { line-height: 1.4; }

.exampleblock.result > .content { -webkit-box-shadow: 0 1px 8px #aaaaaa; box-shadow: 0 1px 8px #aaaaaa; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6, .sidebarblock p { color: #333333; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6 { line-height: 1; margin-bottom: 0.625em; }
.sidebarblock h1.subheader, .sidebarblock h2.subheader, .sidebarblock h3.subheader, .sidebarblock .subheader#toctitle, .sidebarblock > .content > .subheader.title, .sidebarblock h4.subheader, .sidebarblock h5.subheader, .sidebarblock h6.subheader { line-height: 1.4; }
.sidebarblock > .content > .title { color: #003b6b; margin-top: 0; line-height: 1.6; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre:not([class]), .listingblock pre:not([class]) { background: #eeeeee; }
.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border-width: 1px; border-style: dashed; border-color: #666666; -webkit-border-radius: 0; border-radius: 0; padding: 1.25em 1.5625em 1.125em 1.5625em; word-wrap: break-word; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
.literalblock pre > code, .literalblock pre[class] > code, .listingblock pre > code, .listingblock pre[class] > code { display: block; }
@media only screen { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.72em; } }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.81em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.9em; } }

.listingblock pre.highlight { padding: 0; }
.listingblock pre.highlight > code { padding: 1.25em 1.5625em 1.125em 1.5625em; }

.listingblock > .content { position: relative; }

.listingblock:hover code[class*=" language-"]:before { text-transform: uppercase; font-size: 0.9em; color: #999; position: absolute; top: 0.375em; right: 0.375em; }

.listingblock:hover code.asciidoc:before { content: "asciidoc"; }
.listingblock:hover code.clojure:before { content: "clojure"; }
.listingblock:hover code.css:before { content: "css"; }
.listingblock:hover code.groovy:before { content: "groovy"; }
.listingblock:hover code.html:before { content: "html"; }
.listingblock:hover code.java:before { content: "java"; }
.listingblock:hover code.javascript:before { content: "javascript"; }
.listingblock:hover code.python:before { content: "python"; }
.listingblock:hover code.ruby:before { content: "ruby"; }
.listingblock:hover code.sass:before { content: "sass"; }
.listingblock:hover code.scss:before { content: "scss"; }
.listingblock:hover code.xml:before { content: "xml"; }
.listingblock:hover code.yaml:before { content: "yaml"; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: '$'; }

table.pyhltable { border: 0; margin-bottom: 0; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

.highlight.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }

.highlight.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background-color: transparent !important; padding-right: 0 !important; }

.quoteblock { margin: 0 0 0.75em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
.quoteblock blockquote { margin: 0 0 0.75em 0; padding: 0 0 0.5625em 0; border: 0; }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: -.25em; padding-bottom: 0.5625em; font-size: 0.8125em; color: #e15200; }
.quoteblock .attribution br { display: none; }
.quoteblock .attribution cite { display: block; margin-bottom: 0.625em; }

table thead th, table tfoot th { font-weight: bold; }

table.tableblock.grid-all { border-collapse: separate; border-spacing: 1px; -webkit-border-radius: 0; border-radius: 0; border-top: 1px solid #dddddd; border-bottom: 1px solid #dddddd; }

table.tableblock.frame-topbot, table.tableblock.frame-none { border-left: 0; border-right: 0; }

table.tableblock.frame-sides, table.tableblock.frame-none { border-top: 0; border-bottom: 0; }

table.tableblock td .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

th.tableblock.halign-left, td.tableblock.halign-left { text-align: left; }

th.tableblock.halign-right, td.tableblock.halign-right { text-align: right; }

th.tableblock.halign-center, td.tableblock.halign-center { text-align: center; }

th.tableblock.valign-top, td.tableblock.valign-top { vertical-align: top; }

th.tableblock.valign-bottom, td.tableblock.valign-bottom { vertical-align: bottom; }

th.tableblock.valign-middle, td.tableblock.valign-middle { vertical-align: middle; }

tbody tr th { display: table-cell; line-height: 1.4; background: -webkit-linear-gradient(top, #add386, #90b66a); }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: white; font-weight: bold; }

td > div.verse { white-space: pre; }

ol { margin-left: 1.75em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.375em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > i[class^="icon-check"]:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.375em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1 { padding-right: .8em; font-weight: bold; }

td.hdlist1, td.hdlist2 { vertical-align: top; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 .8em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.qanda > ol > li > p > em:only-child { color: #004985; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; }

span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }

#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: none; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > [class^="icon-"], span.icon > [class*=" icon-"] { cursor: default; }

.admonitionblock td.icon [class^="icon-"]:before { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #00579e; color: #004176; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum { display: inline-block; color: white !important; background-color: black; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; width: 20px; height: 20px; font-size: 12px; font-weight: bold; line-height: 20px; font-family: Arial, sans-serif; font-style: normal; position: relative; top: -2px; letter-spacing: -1px; }
.conum * { color: white !important; }
.conum + b { display: none; }
.conum:after { content: attr(data-value); }
.conum:not([data-value]):empty { display: none; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { border-bottom: 1px solid #dddddd; }

#toctitle { color: #00406F; font-weight: normal; margin-top: 1.5em; }

.sidebarblock { border-color: #aaa; }

code { -webkit-border-radius: 4px; border-radius: 4px; }

p.tableblock.header { color: #6d6e71; }</style><link rel="stylesheet" href="./HA Deployment Lab_files/font-awesome.min.css"><link rel="stylesheet" href="./HA Deployment Lab_files/sunburst.min.css"><script src="./HA Deployment Lab_files/highlight.min.js.下载"></script><script>hljs.initHighlightingOnLoad()</script><style>#cVim-command-bar, #cVim-command-bar-mode, #cVim-command-bar-input, #cVim-command-bar-search-results,
.cVim-completion-item, .cVim-completion-item .cVim-full, .cVim-completion-item .cVim-left,
.cVim-completion-item .cVim-right {
  font-family: Helvetica, Helvetica Neue, Neue, sans-serif, monospace, Arial;
  font-size: 10pt !important;
  -webkit-font-smoothing: antialiased !important;
}

#cVim-command-bar {
  position: fixed;
  z-index: 2147483646;
  background-color: #1b1d1e;
  color: #bbb;
  display: none;
  box-sizing: content-box;
  box-shadow: 0 3px 3px rgba(0,0,0,0.4);
  left: 0;
  width: 100%;
  height: 20px;
}

#cVim-command-bar-mode {
  display: inline-block;
  vertical-align: middle;
  box-sizing: border-box;
  padding-left: 2px;
  height: 100%;
  width: 10px;
  padding-top: 2px;
  color: #888;
}

#cVim-command-bar-input {
  background-color: #1b1d1e;
  color: #bbb;
  height: 100%;
  right: 0;
  top: 0;
  width: calc(100% - 10px);
  position: absolute;
}

#cVim-command-bar-search-results {
  position: fixed;
  width: 100%;
  overflow: hidden;
  z-index: 2147483647;
  left: 0;
  box-shadow: 0 3px 3px rgba(0,0,0,0.4);
  background-color: #1c1c1c;
}

.cVim-completion-item, .cVim-completion-item .cVim-full, .cVim-completion-item .cVim-left, .cVim-completion-item .cVim-right {
  text-overflow: ellipsis;
  padding: 1px;
  display: inline-block;
  box-sizing: border-box;
  vertical-align: middle;
  overflow: hidden;
  white-space: nowrap;
}

.cVim-completion-item:nth-child(even) {
  background-color: #1f1f1f;
}

.cVim-completion-item {
  width: 100%; left: 0;
  color: #bcbcbc;
}

.cVim-completion-item[active] {
  width: 100%; left: 0;
  color: #1b1d1e;
  background-color: #f1f1f1;
}

.cVim-completion-item[active] span {
  color: #1b1d1e;
}

.cVim-completion-item .cVim-left {
  color: #fff;
  width: 37%;
}

.cVim-completion-item .cVim-right {
  font-style: italic;
  color: #888;
  width: 57%;
}


#cVim-link-container, .cVim-link-hint,
#cVim-hud, #cVim-status-bar {
  font-family: Helvetica, Helvetica Neue, Neue, sans-serif, monospace, Arial;
  font-size: 10pt !important;
  -webkit-font-smoothing: antialiased !important;
}

#cVim-link-container {
  position: absolute;
  pointer-events: none;
  width: 100%; left: 0;
  height: 100%; top: 0;
  z-index: 2147483647;
}

.cVim-link-hint {
  position: absolute;
  color: #302505 !important;
  background-color: #ffd76e !important;
  border-radius: 2px !important;
  padding: 2px !important;
  font-size: 8pt !important;
  font-weight: 500 !important;
  text-transform: uppercase !important;
  border: 1px solid #ad810c;
  display: inline-block !important;
  vertical-align: middle !important;
  text-align: center !important;
  box-shadow: 2px 2px 1px rgba(0,0,0,0.25) !important;
}

.cVim-link-hint_match {
  color: #777;
  text-transform: uppercase !important;
}


#cVim-hud {
  background-color: rgba(28,28,28,0.9);
  position: fixed !important;
  transition: right 0.2s ease-out;
  z-index: 24724289;
}

#cVim-hud span {
  padding: 2px;
  padding-left: 4px;
  padding-right: 4px;
  color: #8f8f8f;
  font-size: 10pt;
}

#cVim-frames-outline {
  position: fixed;
  width: 100%;
  height: 100%;
  left: 0;
  top: 0;
  right: 0;
  z-index: 9999999999;
  box-sizing: border-box;
  border: 3px solid yellow;
}
</style></head><body class="article toc2 toc-left"><div id="header"><div id="toc" class="toc2"><div id="toctitle">Table of Contents</div><ul class="sectlevel1">
<li><a href="https://www.opentlc.com/labs/ocp_advanced_deployment/02_1_HA_Deployment_Solution_Lab.html#_ha_deployment_lab">HA Deployment Lab</a></li>
<li><a href="https://www.opentlc.com/labs/ocp_advanced_deployment/02_1_HA_Deployment_Solution_Lab.html#_provision_lab_environment">1. Provision Lab Environment</a></li>
<li>
<ul class="sectlevel2">
<li><a href="https://www.opentlc.com/labs/ocp_advanced_deployment/02_1_HA_Deployment_Solution_Lab.html#_share_public_key_with_opentlc">1.1. Share Public Key with OPENTLC</a></li>
<li><a href="https://www.opentlc.com/labs/ocp_advanced_deployment/02_1_HA_Deployment_Solution_Lab.html#_start_environment_after_shut_down">1.2. Start Environment After Shut Down</a></li>
<li><a href="https://www.opentlc.com/labs/ocp_advanced_deployment/02_1_HA_Deployment_Solution_Lab.html#_test_server_connections">1.3. Test Server Connections</a></li>
<li><a href="https://www.opentlc.com/labs/ocp_advanced_deployment/02_1_HA_Deployment_Solution_Lab.html#_prepare_guid_environment_variable_across_all_hosts">1.4. Prepare GUID environment variable across all hosts</a></li>
</ul>
</li>
<li><a href="https://www.opentlc.com/labs/ocp_advanced_deployment/02_1_HA_Deployment_Solution_Lab.html#labexercises">2. Configure Red Hat Enterprise Linux 7 Hosts for OpenShift Deployment</a></li>
<li>
<ul class="sectlevel2">
<li><a href="https://www.opentlc.com/labs/ocp_advanced_deployment/02_1_HA_Deployment_Solution_Lab.html#_explore_and_verify_infrastructure_deployment">2.1. Explore and Verify Infrastructure Deployment</a></li>
<li><a href="https://www.opentlc.com/labs/ocp_advanced_deployment/02_1_HA_Deployment_Solution_Lab.html#_verify_installation_and_configuration_of_docker">2.2. Verify Installation and Configuration of Docker</a></li>
<li><a href="https://www.opentlc.com/labs/ocp_advanced_deployment/02_1_HA_Deployment_Solution_Lab.html#_verify_yum_repositories_and_nfs_shared_volumes_on_hosts">2.3. Verify Yum Repositories and NFS Shared Volumes on Hosts</a></li>
</ul>
</li>
<li><a href="https://www.opentlc.com/labs/ocp_advanced_deployment/02_1_HA_Deployment_Solution_Lab.html#_deploy_highly_available_openshift_cluster">3. Deploy Highly Available OpenShift Cluster</a></li>
<li>
<ul class="sectlevel2">
<li><a href="https://www.opentlc.com/labs/ocp_advanced_deployment/02_1_HA_Deployment_Solution_Lab.html#_requirements_for_openshift_deployment">3.1. Requirements for OpenShift Deployment</a></li>
<li><a href="https://www.opentlc.com/labs/ocp_advanced_deployment/02_1_HA_Deployment_Solution_Lab.html#_basic_required_ansible_inventory_parameters">3.2. Basic Required Ansible Inventory Parameters</a></li>
<li><a href="https://www.opentlc.com/labs/ocp_advanced_deployment/02_1_HA_Deployment_Solution_Lab.html#_configure_authentication_against_ipa_ldap_server">3.3. Configure Authentication Against IPA (LDAP) Server</a></li>
<li><a href="https://www.opentlc.com/labs/ocp_advanced_deployment/02_1_HA_Deployment_Solution_Lab.html#_execute_the_code_openshift_ansible_code_deployer">3.4. Execute the <code>openshift-ansible</code> Deployer</a></li>
<li><a href="https://www.opentlc.com/labs/ocp_advanced_deployment/02_1_HA_Deployment_Solution_Lab.html#_uninstalling_openshift">3.5. Uninstalling OpenShift</a></li>
</ul>
</li>
<li><a href="https://www.opentlc.com/labs/ocp_advanced_deployment/02_1_HA_Deployment_Solution_Lab.html#_verify_openshift_cluster">4. Verify OpenShift Cluster</a></li>
<li>
<ul class="sectlevel2">
<li><a href="https://www.opentlc.com/labs/ocp_advanced_deployment/02_1_HA_Deployment_Solution_Lab.html#_verify_configuration">4.1. Verify Configuration</a></li>
<li><a href="https://www.opentlc.com/labs/ocp_advanced_deployment/02_1_HA_Deployment_Solution_Lab.html#_verify_authentication_provider_configuration">4.2. Verify Authentication Provider Configuration</a></li>
<li><a href="https://www.opentlc.com/labs/ocp_advanced_deployment/02_1_HA_Deployment_Solution_Lab.html#_synchronize_groups_from_ipa_server_to_openshift_cluster">4.3. Synchronize Groups from IPA Server to OpenShift Cluster</a></li>
<li><a href="https://www.opentlc.com/labs/ocp_advanced_deployment/02_1_HA_Deployment_Solution_Lab.html#_test_run_group_synchronization_optional">4.4. Test Run Group Synchronization [ Optional ]</a></li>
<li><a href="https://www.opentlc.com/labs/ocp_advanced_deployment/02_1_HA_Deployment_Solution_Lab.html#_synchronize_groups">4.5. Synchronize Groups</a></li>
</ul>
</li>
<li><a href="https://www.opentlc.com/labs/ocp_advanced_deployment/02_1_HA_Deployment_Solution_Lab.html#_post_installation_configuration">5. Post installation configuration</a></li>
<li>
<ul class="sectlevel2">
<li><a href="https://www.opentlc.com/labs/ocp_advanced_deployment/02_1_HA_Deployment_Solution_Lab.html#_create_pvs_for_users">5.1. Create PVs for Users</a></li>
<li><a href="https://www.opentlc.com/labs/ocp_advanced_deployment/02_1_HA_Deployment_Solution_Lab.html#_fix_nfs_persistent_volume_recycling">5.2. Fix NFS Persistent Volume Recycling</a></li>
</ul>
</li>
<li><a href="https://www.opentlc.com/labs/ocp_advanced_deployment/02_1_HA_Deployment_Solution_Lab.html#_smoke_test">6. Smoke Test</a></li>
</ul></div></div><div id="content"><div class="sect1"><h2 id="_ha_deployment_lab">HA Deployment Lab</h2><div class="sectionbody"><div class="paragraph"><p>In this lab’s scenario, you are a consultant assigned to MitziCom, a telecommunications company. MitziCom provides hosting and cloud services to a variety of clients, ranging from medium-sized companies to enterprise giants.</p></div>
<div class="paragraph"><p>MitziCom has asked you to lead a 30- to 40-hour proof-of-concept (POC) using Red Hat OpenShift Container Platform. The purpose of the POC is to determine the feasibility of using Red Hat OpenShift Container Platform as a target for internal and client workloads.</p></div>
<div class="paragraph"><p>The lab details a recommended process for meeting MitziCom’s requirements, as defined in the lab’s goals. Information about the infrastructure, DNS names, passwords, and more is provided throughout the lab.</p></div>
<div class="admonitionblock tip"><table><tbody><tr><td class="icon"><i class="icon-tip" title="Tip"></i></td><td class="content">Because the lab does not include all of the required steps and commands, you will want to consult the <a href="https://docs.openshift.com/container-platform/3.9/welcome/index.html">OpenShift Container Platform</a> product documentation. This link is especially useful for research and troubleshooting. Your instructor is also available to help you.</td></tr></tbody></table></div>
<div class="paragraph"><div class="title">Goals</div><p>In this lab, you deploy and configure OpenShift Container Platform on a group of servers to meet these requirements:</p></div>
<div class="ulist"><ul><li><p>Configure Red Hat Enterprise Linux 7 hosts for OpenShift deployment</p></li><li><p>Deploy a highly available OpenShift Container Platform cluster</p></li><li><p>Configure the OpenShift Container Platform cluster</p></li></ul></div>
<div class="ulist"><div class="title">Provisioned Environment Hosts</div><ul><li><p>Bastion host: <code>bastion.$GUID.example.opentlc.com</code>, <code>bastion.$GUID.internal</code></p></li><li><p>Load balancer: <code>loadbalancer.$GUID.example.opentlc.com</code>, <code>loadbalancer1.$GUID.internal</code></p></li><li><p>3 OpenShift master nodes: <code>master{1,2,3}.$GUID.internal</code></p></li><li><p>2 OpenShift infrastructure nodes: <code>infranode{1,2}.$GUID.example.opentlc.com</code>, <code>infranode{1,2}.$GUID.internal</code></p></li><li><p>3 OpenShift worker nodes: <code>node{1-2}.$GUID.internal</code></p></li><li><p>IPA Server: <code>ipa.shared.example.opentlc.com</code> (shared resource for all students)</p></li><li><p>NFS server: <code>support1.$GUID.internal</code></p></li><li><p>3 GlusterFS servers: <code>support{1-3}.$GUID.internal</code></p><div class="ulist"><ul><li><p>These servers are initially disabled</p></li></ul></div></li></ul></div></div></div>
<div class="sect1"><h2 id="_provision_lab_environment">1. Provision Lab Environment</h2><div class="sectionbody"><div class="admonitionblock note"><table><tbody><tr><td class="icon"><i class="icon-note" title="Note"></i></td><td class="content">If you previously set up an environment for this class, you can skip this section and go directly to the <a href="https://www.opentlc.com/labs/ocp_advanced_deployment/02_1_HA_Deployment_Solution_Lab.html#labexercises">Configure Red Hat Enterprise Linux 7 Hosts for OpenShift Deployment</a> section.</td></tr></tbody></table></div>
<div class="paragraph"><p>In this section, you provision the lab environment to provide access to all of the components required to perform the labs. The lab environment is a shared cloud-based environment, so that you can access it over the Internet from anywhere. However, do not expect performance to match a dedicated environment.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Go to the <a href="https://labs.opentlc.com/" target="_blank">OPENTLC lab portal</a> and use your OPENTLC credentials to log in.</p><div class="admonitionblock tip"><table><tbody><tr><td class="icon"><i class="icon-tip" title="Tip"></i></td><td class="content">If you do not remember your password, go to the <a href="https://www.opentlc.com/account/" target="_blank">OPENTLC Account Management page</a> to reset your password.</td></tr></tbody></table></div></li><li><p>Navigate to <strong>Services → Catalogs → All Services → OPENTLC OpenShift Labs</strong>.</p></li><li><p>On the left, select <strong>OpenShift HA Lab</strong>.</p></li><li><p>On the right, click <strong>Order</strong>.</p></li><li><p>If you are not in North America, click <strong>Lab Parameters</strong> and select your appropriate region.</p></li><li><p>On the bottom right, click <strong>Submit</strong>.</p><div class="admonitionblock warning"><table><tbody><tr><td class="icon"><i class="icon-warning" title="Warning"></i></td><td class="content">Do not select <strong>App Control → Start</strong> after ordering the lab. Ordering the lab automatically begins the build process. Selecting <strong>Start</strong> may corrupt the lab environment or cause other complications.</td></tr></tbody></table></div>
<div class="ulist"><ul><li><p>After a few minutes, expect to receive an email with instructions on how to connect to the environment.</p></li></ul></div></li><li><p>You will receive three e-mails:</p><div class="listingblock"><div class="title">Provisioning started</div><div class="content"><pre class="highlight"><code class="text language-text hljs xml">Provisioning has started on your Red Hat OPENTLC OTLC-LAB-<span class="hljs-tag">&lt;<span class="hljs-title">OPENTLC</span> <span class="hljs-attribute">Username</span>&gt;</span>-PROD_OCP_HA_LAB-<span class="hljs-tag">&lt;<span class="hljs-title">GUID</span>&gt;</span> environment.
You will receive more information via email during the build process within the next 30 minutes.</code></pre></div></div>
<div class="listingblock"><div class="title">Provisioning has updated (this means that the VMs have been requested successfully)</div><div class="content"><pre class="highlight"><code class="text language-text hljs coffeescript">Provisioning <span class="hljs-keyword">is</span> continuing <span class="hljs-keyword">for</span> Red Hat OPENTLC service OTLC-LAB-&lt;OPENTLC Username&gt;-PROD_OCP_HA_LAB-&lt;GUID&gt;.
You will receive another email <span class="hljs-keyword">when</span> the environment <span class="hljs-keyword">is</span> available within the next <span class="hljs-number">30</span> minutes.</code></pre></div></div>
<div class="listingblock"><div class="title">Provisioning completed</div><div class="content"><pre class="highlight"><code class="text language-text hljs coffeescript">Your environment <span class="hljs-keyword">for</span> OTLC-LAB-&lt;OPENTLC Username&gt;-PROD_OCP_HA_LAB-c3fc has been provisioned.
Your unique identifier, GUID, <span class="hljs-attribute">is</span>: c3fc

Access to the environment will be granted as soon as the environment deployment <span class="hljs-keyword">is</span> complete.

Please refer to your lab instructions <span class="hljs-literal">on</span> next steps <span class="hljs-keyword">and</span> how to access your environment.

If your lab/demo instructions indicate connecting <span class="hljs-reserved">with</span> SSH, use your OPENTLC private key, <span class="hljs-keyword">and</span> user name &lt;OPENTLC Username&gt;.

Here <span class="hljs-keyword">is</span> an <span class="hljs-attribute">example</span>:

$ ssh -i ~/.ssh/your_private_key_name &lt;OPENTLC Username&gt;<span class="hljs-property">@bastion</span>.&lt;GUID&gt;&gt;.example.opentlc.com

Troubleshooting <span class="hljs-keyword">and</span> Access <span class="hljs-attribute">issues</span>:

If you need help setting up SSH client <span class="hljs-literal">on</span> your workstation, use <span class="hljs-attribute">http</span>:<span class="hljs-regexp">//</span>www.opentlc.com/ssh.html.
If you did <span class="hljs-keyword">not</span> share your public key <span class="hljs-reserved">with</span> OPENTLC (For ssh connections) <span class="hljs-keyword">or</span> <span class="hljs-keyword">if</span> you need to reset your OPENTLC password (For Web Console access), you can use <span class="hljs-keyword">this</span> <span class="hljs-attribute">link</span>: <span class="hljs-attribute">https</span>:<span class="hljs-regexp">//</span>account.opentlc.com<span class="hljs-regexp">/account/</span>

<span class="hljs-attribute">NOTICE</span>: Your environment will expire <span class="hljs-keyword">and</span> be deleted <span class="hljs-keyword">in</span> <span class="hljs-number">7</span> day(s) at <span class="hljs-number">2018</span>-<span class="hljs-number">04</span>-<span class="hljs-number">25</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> -<span class="hljs-number">0400</span> <span class="hljs-keyword">and</span> will be idled down after <span class="hljs-number">8</span> hour(s).

In order to conserve resources, we cannot archive <span class="hljs-keyword">or</span> restore any data <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span> environment. All data will be lost upon expiration.</code></pre></div></div></li><li><p>Wait until you receive the final e-mail before trying to connect to your environment.</p></li><li><p>Note the GUID (a 4 character ID, <code>c3fc</code> in the e-mail above) of your environment.</p></li></ol></div>
<div class="sect2"><h3 id="_share_public_key_with_opentlc">1.1. Share Public Key with OPENTLC</h3><div class="paragraph"><p>To access any of your lab systems via SSH, you must use your personal OPENTLC SSO username and public SSH key.</p></div>
<div class="paragraph"><p>If you have not already done so, you must provide a public SSH key to the OPENTLC authentication system:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Go to the <a href="https://www.opentlc.com/account/" target="_blank">OPENTLC Account Management page</a>.</p></li><li><p>Click <strong>Update SSH Key</strong> and log in using your OPENTLC credentials.</p></li><li><p>Paste your public key in that location.</p><div class="admonitionblock note"><table><tbody><tr><td class="icon"><i class="icon-note" title="Note"></i></td><td class="content">For more information on generating SSH keys, see <a href="https://www.opentlc.com/ssh.html" target="_blank">Setting Up an SSH Key Pair</a>.</td></tr></tbody></table></div></li></ol></div></div>
<div class="sect2"><h3 id="_start_environment_after_shut_down">1.2. Start Environment After Shut Down</h3><div class="paragraph"><p>To conserve resources, the lab environment shuts down automatically after eight hours. In this section, you restart the lab environment for this course after it has shut down automatically.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Go to the <a href="https://labs.opentlc.com/" target="_blank">OPENTLC lab portal</a> and use your OPENTLC credentials to log in.</p></li><li><p>Navigate to <strong>Services → My Services</strong> (this should be the screen shown right after logging in).</p></li><li><p>In the list of your services, select your lab environment.</p></li><li><p>Select <strong>App Control → Start</strong> to start your lab environment.</p></li><li><p>Select <strong>Yes</strong> at the <strong>Are you sure?</strong> prompt.</p></li><li><p>On the bottom right, click <strong>Submit</strong>.</p></li></ol></div>
<div class="paragraph"><p>After a few minutes, expect to receive an email letting you know that the lab environment has been started.</p></div></div>
<div class="sect2"><h3 id="_test_server_connections">1.3. Test Server Connections</h3><div class="paragraph"><p>The <code>bastion</code> administration host serves as an access point into the environment and is not part of the OpenShift environment.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Connect to your administration host and make sure you can access each of your provisioned hosts:</p><div class="listingblock"><div class="content"><pre>ssh -i ~/.ssh/yourprivatekey.key opentlc-username@bastion.$GUID.example.opentlc.com</pre></div></div></li></ol></div>
<div class="admonitionblock note"><table><tbody><tr><td class="icon"><i class="icon-note" title="Note"></i></td><td class="content"><div class="ulist"><ul><li><p>In the labs, "$GUID" is used to represent your 4-character unique
identifier. Your GUID is located at the top of your lab provisioning email.</p></li><li><p>Make sure to replace "$GUID" with your GUID as shown in the example below:</p><div class="listingblock"><div class="content"><pre>ssh -i ~/.ssh/yourprivatekey.key shacharb-redhat.com@bastion.r2d2.example.opentlc.com</pre></div></div></li><li><p>Red Hat recommends that you create an environment variable so you
do not have to type your GUID each time.</p></li></ul></div></td></tr></tbody></table></div></div>
<div class="sect2"><h3 id="_prepare_guid_environment_variable_across_all_hosts">1.4. Prepare GUID environment variable across all hosts</h3><div class="paragraph"><p>To make running commands specific to your environment easier, run the following ansible command to create a GUID environment variables on all hosts in your cluster that are managed by ansible.</p></div>
<div class="ulist"><ul><li><p>All GUID env variable to <code>$HOME/.bashrc</code> by connecting to the <code>bastion</code> host and executing the ad-hoc ansible command:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs">ssh -i ~/.ssh/yourprivatekey.key opentlc-username@bastion.<span class="hljs-variable">$GUID</span>.example.opentlc.com
sudo -i
ansible localhost,all -m shell <span class="hljs-operator">-a</span> <span class="hljs-string">'export GUID=`hostname | cut -d"." -f2`; echo "export GUID=$GUID" &gt;&gt; $HOME/.bashrc'</span></code></pre></div></div></li></ul></div></div></div></div>
<div class="sect1"><h2 id="labexercises">2. Configure Red Hat Enterprise Linux 7 Hosts for OpenShift Deployment</h2><div class="sectionbody"><div class="paragraph"><p>In this section, you prepare the hosts for installation. You then make sure that the correct Docker version is installed and configured. You also configure yum repositories on the hosts.</p></div>
<div class="sect2"><h3 id="_explore_and_verify_infrastructure_deployment">2.1. Explore and Verify Infrastructure Deployment</h3><div class="paragraph"><p>Instances are already created for you, and an <code>/etc/ansible/hosts</code> file is populated with the hosts in your cluster.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Verify that the Ansible hosts file is populated.</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs"><span class="hljs-comment"># cat /etc/ansible/hosts</span></code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlight nowrap"><code class="ini language-ini hljs"><span class="hljs-title">[OSEv3:vars]</span>

###########################################################################
### Ansible Vars
###########################################################################
<span class="hljs-setting">timeout=<span class="hljs-value"><span class="hljs-number">60</span></span></span>
<span class="hljs-setting">ansible_become=<span class="hljs-value"><span class="hljs-keyword">yes</span></span></span>
<span class="hljs-setting">ansible_ssh_user=<span class="hljs-value">ec2-user</span></span>

# disable memory check, as we are not a production environment
<span class="hljs-setting">openshift_disable_check=<span class="hljs-value"><span class="hljs-string">"memory_availability"</span></span></span>

<span class="hljs-title">[OSEv3:children]</span>
lb
masters
etcd
nodes
nfs

<span class="hljs-title">[lb]</span>
loadbalancer1.GUID.internal host_zone=eu-central-1a

<span class="hljs-title">[masters]</span>
master1.GUID.internal host_zone=eu-central-1a
master2.GUID.internal host_zone=eu-central-1a
master3.GUID.internal host_zone=eu-central-1a

<span class="hljs-title">[etcd]</span>
master1.GUID.internal host_zone=eu-central-1a
master2.GUID.internal host_zone=eu-central-1a
master3.GUID.internal host_zone=eu-central-1a

<span class="hljs-title">[nodes]</span>
## These are the masters
master1.GUID.internal openshift_hostname=master1.GUID.internal  openshift_node_labels="{'env': 'master', 'cluster': 'GUID', 'zone': 'eu-central-1a'}"
master2.GUID.internal openshift_hostname=master2.GUID.internal  openshift_node_labels="{'env': 'master', 'cluster': 'GUID', 'zone': 'eu-central-1a'}"
master3.GUID.internal openshift_hostname=master3.GUID.internal  openshift_node_labels="{'env': 'master', 'cluster': 'GUID', 'zone': 'eu-central-1a'}"

## These are infranodes
infranode1.GUID.internal openshift_hostname=infranode1.GUID.internal  openshift_node_labels="{'env':'infra', 'cluster': 'GUID', 'zone': 'eu-central-1a'}"
infranode2.GUID.internal openshift_hostname=infranode2.GUID.internal  openshift_node_labels="{'env':'infra', 'cluster': 'GUID', 'zone': 'eu-central-1a'}"

## These are regular nodes
node1.GUID.internal openshift_hostname=node1.GUID.internal  openshift_node_labels="{'env':'app', 'cluster': 'GUID', 'zone': 'eu-central-1a'}"
node2.GUID.internal openshift_hostname=node2.GUID.internal  openshift_node_labels="{'env':'app', 'cluster': 'GUID', 'zone': 'eu-central-1a'}"
node3.GUID.internal openshift_hostname=node3.GUID.internal  openshift_node_labels="{'env':'app', 'cluster': 'GUID', 'zone': 'eu-central-1a'}"

## These are CNS nodes
# support1.GUID.internal openshift_hostname=support1.GUID.internal  openshift_node_labels="{'env':'glusterfs', 'cluster': 'GUID', 'zone': 'eu-central-1a'}"
# support2.GUID.internal openshift_hostname=support2.GUID.internal  openshift_node_labels="{'env':'glusterfs', 'cluster': 'GUID', 'zone': 'eu-central-1a'}"
# support3.GUID.internal openshift_hostname=support3.GUID.internal  openshift_node_labels="{'env':'glusterfs', 'cluster': 'GUID', 'zone': 'eu-central-1a'}"

<span class="hljs-title">[nfs]</span>
support1.GUID.internal openshift_hostname=support1.GUID.internal

#<span class="hljs-title">[glusterfs]</span>
# support1.GUID.internal glusterfs_devices='<span class="hljs-title">[ "/dev/xvdd" ]</span>'
# support2.GUID.internal glusterfs_devices='<span class="hljs-title">[ "/dev/xvdd" ]</span>'
# support3.GUID.internal glusterfs_devices='<span class="hljs-title">[ "/dev/xvdd" ]</span>'</code></pre></div></div></li><li><p>Use the Ansible <code>--list-hosts</code> command line to list the masters, nodes, and all of the host groups.</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs">ansible masters --list-hosts</code></pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="highlight"><code class="text language-text hljs cs">  hosts (<span class="hljs-number">3</span>):
    master1.GUID.<span class="hljs-keyword">internal</span>
    master2.GUID.<span class="hljs-keyword">internal</span>
    master3.GUID.<span class="hljs-keyword">internal</span></code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs">ansible nodes --list-hosts</code></pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="highlight"><code class="text language-text hljs cs">  hosts (<span class="hljs-number">8</span>):
    master1.GUID.<span class="hljs-keyword">internal</span>
    master2.GUID.<span class="hljs-keyword">internal</span>
    master3.GUID.<span class="hljs-keyword">internal</span>
    infranode1.GUID.<span class="hljs-keyword">internal</span>
    infranode2.GUID.<span class="hljs-keyword">internal</span>
    node1.GUID.<span class="hljs-keyword">internal</span>
    node2.GUID.<span class="hljs-keyword">internal</span>
    node3.GUID.<span class="hljs-keyword">internal</span></code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs">ansible all --list-hosts</code></pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="highlight"><code class="text language-text hljs cs">  hosts (<span class="hljs-number">10</span>):
    master1.GUID.<span class="hljs-keyword">internal</span>
    master2.GUID.<span class="hljs-keyword">internal</span>
    master3.GUID.<span class="hljs-keyword">internal</span>
    infranode1.GUID.<span class="hljs-keyword">internal</span>
    infranode2.GUID.<span class="hljs-keyword">internal</span>
    node1.GUID.<span class="hljs-keyword">internal</span>
    node2.GUID.<span class="hljs-keyword">internal</span>
    node3.GUID.<span class="hljs-keyword">internal</span>
    loadbalancer1.GUID.<span class="hljs-keyword">internal</span>
    support1.GUID.<span class="hljs-keyword">internal</span></code></pre></div></div></li><li><p>Verify that all of your hosts are running:</p><div class="listingblock"><div class="content"><pre>ansible all -m ping</pre></div></div></li></ol></div></div>
<div class="sect2"><h3 id="_verify_installation_and_configuration_of_docker">2.2. Verify Installation and Configuration of Docker</h3><div class="olist arabic"><ol class="arabic"><li><p>Verify that Docker is running on all of the nodes in the cluster.</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs">ansible nodes -m shell <span class="hljs-operator">-a</span><span class="hljs-string">"systemctl status docker | grep Active"</span></code></pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="highlight"><code class="text language-text hljs ruby">infranode1.<span class="hljs-constant">GUID</span>.internal | <span class="hljs-constant">SUCCESS</span> | rc=<span class="hljs-number">0</span> <span class="hljs-prompt">&gt;&gt;
   </span><span class="hljs-constant">Active</span><span class="hljs-symbol">:</span> active (running) since <span class="hljs-constant">Thu</span> <span class="hljs-number">2017</span>-<span class="hljs-number">03</span>-<span class="hljs-number">16</span> <span class="hljs-number">20</span><span class="hljs-symbol">:</span><span class="hljs-number">11</span><span class="hljs-symbol">:</span><span class="hljs-number">10</span> <span class="hljs-constant">EDT</span>; <span class="hljs-number">23</span>min ago

master2.<span class="hljs-constant">GUID</span>.internal | <span class="hljs-constant">SUCCESS</span> | rc=<span class="hljs-number">0</span> <span class="hljs-prompt">&gt;&gt;
   </span><span class="hljs-constant">Active</span><span class="hljs-symbol">:</span> active (running) since <span class="hljs-constant">Thu</span> <span class="hljs-number">2017</span>-<span class="hljs-number">03</span>-<span class="hljs-number">16</span> <span class="hljs-number">20</span><span class="hljs-symbol">:</span><span class="hljs-number">11</span><span class="hljs-symbol">:</span><span class="hljs-number">19</span> <span class="hljs-constant">EDT</span>; <span class="hljs-number">23</span>min ago

master3.<span class="hljs-constant">GUID</span>.internal | <span class="hljs-constant">SUCCESS</span> | rc=<span class="hljs-number">0</span> <span class="hljs-prompt">&gt;&gt;
   </span><span class="hljs-constant">Active</span><span class="hljs-symbol">:</span> active (running) since <span class="hljs-constant">Thu</span> <span class="hljs-number">2017</span>-<span class="hljs-number">03</span>-<span class="hljs-number">16</span> <span class="hljs-number">20</span><span class="hljs-symbol">:</span><span class="hljs-number">11</span><span class="hljs-symbol">:</span><span class="hljs-number">18</span> <span class="hljs-constant">EDT</span>; <span class="hljs-number">23</span>min ago

master1.<span class="hljs-constant">GUID</span>.internal | <span class="hljs-constant">SUCCESS</span> | rc=<span class="hljs-number">0</span> <span class="hljs-prompt">&gt;&gt;
   </span><span class="hljs-constant">Active</span><span class="hljs-symbol">:</span> active (running) since <span class="hljs-constant">Thu</span> <span class="hljs-number">2017</span>-<span class="hljs-number">03</span>-<span class="hljs-number">16</span> <span class="hljs-number">20</span><span class="hljs-symbol">:</span><span class="hljs-number">11</span><span class="hljs-symbol">:</span><span class="hljs-number">18</span> <span class="hljs-constant">EDT</span>; <span class="hljs-number">23</span>min ago

infranode2.<span class="hljs-constant">GUID</span>.internal | <span class="hljs-constant">SUCCESS</span> | rc=<span class="hljs-number">0</span> <span class="hljs-prompt">&gt;&gt;
   </span><span class="hljs-constant">Active</span><span class="hljs-symbol">:</span> active (running) since <span class="hljs-constant">Thu</span> <span class="hljs-number">2017</span>-<span class="hljs-number">03</span>-<span class="hljs-number">16</span> <span class="hljs-number">20</span><span class="hljs-symbol">:</span><span class="hljs-number">11</span><span class="hljs-symbol">:</span><span class="hljs-number">10</span> <span class="hljs-constant">EDT</span>; <span class="hljs-number">23</span>min ago

node1.<span class="hljs-constant">GUID</span>.internal | <span class="hljs-constant">SUCCESS</span> | rc=<span class="hljs-number">0</span> <span class="hljs-prompt">&gt;&gt;
  </span><span class="hljs-constant">Active</span><span class="hljs-symbol">:</span> active (running) since <span class="hljs-constant">Thu</span> <span class="hljs-number">2017</span>-<span class="hljs-number">03</span>-<span class="hljs-number">16</span> <span class="hljs-number">20</span><span class="hljs-symbol">:</span><span class="hljs-number">11</span><span class="hljs-symbol">:</span><span class="hljs-number">10</span> <span class="hljs-constant">EDT</span>; <span class="hljs-number">23</span>min ago

node2.<span class="hljs-constant">GUID</span>.internal | <span class="hljs-constant">SUCCESS</span> | rc=<span class="hljs-number">0</span> <span class="hljs-prompt">&gt;&gt;
   </span><span class="hljs-constant">Active</span><span class="hljs-symbol">:</span> active (running) since <span class="hljs-constant">Thu</span> <span class="hljs-number">2017</span>-<span class="hljs-number">03</span>-<span class="hljs-number">16</span> <span class="hljs-number">20</span><span class="hljs-symbol">:</span><span class="hljs-number">11</span><span class="hljs-symbol">:</span><span class="hljs-number">10</span> <span class="hljs-constant">EDT</span>; <span class="hljs-number">23</span>min ago</code></pre></div></div></li><li><p>Make sure that the Docker version is correct for the desired OpenShift version</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs">ansible nodes -m shell <span class="hljs-operator">-a</span><span class="hljs-string">"docker version|grep Version"</span></code></pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="highlight"><code class="text language-text hljs ruby">master2.<span class="hljs-constant">GUID</span>.internal | <span class="hljs-constant">SUCCESS</span> | rc=<span class="hljs-number">0</span> <span class="hljs-prompt">&gt;&gt;
 </span><span class="hljs-constant">Version</span><span class="hljs-symbol">:</span>         <span class="hljs-number">1.13</span>.<span class="hljs-number">1</span>
 <span class="hljs-constant">Version</span><span class="hljs-symbol">:</span>         <span class="hljs-number">1.13</span>.<span class="hljs-number">1</span>

master1.<span class="hljs-constant">GUID</span>.internal | <span class="hljs-constant">SUCCESS</span> | rc=<span class="hljs-number">0</span> <span class="hljs-prompt">&gt;&gt;
 </span><span class="hljs-constant">Version</span><span class="hljs-symbol">:</span>         <span class="hljs-number">1.13</span>.<span class="hljs-number">1</span>
 <span class="hljs-constant">Version</span><span class="hljs-symbol">:</span>         <span class="hljs-number">1.13</span>.<span class="hljs-number">1</span>

master3.<span class="hljs-constant">GUID</span>.internal | <span class="hljs-constant">SUCCESS</span> | rc=<span class="hljs-number">0</span> <span class="hljs-prompt">&gt;&gt;
 </span><span class="hljs-constant">Version</span><span class="hljs-symbol">:</span>         <span class="hljs-number">1.13</span>.<span class="hljs-number">1</span>
 <span class="hljs-constant">Version</span><span class="hljs-symbol">:</span>         <span class="hljs-number">1.13</span>.<span class="hljs-number">1</span>

infranode2.<span class="hljs-constant">GUID</span>.internal | <span class="hljs-constant">SUCCESS</span> | rc=<span class="hljs-number">0</span> <span class="hljs-prompt">&gt;&gt;
 </span><span class="hljs-constant">Version</span><span class="hljs-symbol">:</span>         <span class="hljs-number">1.13</span>.<span class="hljs-number">1</span>
 <span class="hljs-constant">Version</span><span class="hljs-symbol">:</span>         <span class="hljs-number">1.13</span>.<span class="hljs-number">1</span>

infranode1.<span class="hljs-constant">GUID</span>.internal | <span class="hljs-constant">SUCCESS</span> | rc=<span class="hljs-number">0</span> <span class="hljs-prompt">&gt;&gt;
 </span><span class="hljs-constant">Version</span><span class="hljs-symbol">:</span>         <span class="hljs-number">1.13</span>.<span class="hljs-number">1</span>
 <span class="hljs-constant">Version</span><span class="hljs-symbol">:</span>         <span class="hljs-number">1.13</span>.<span class="hljs-number">1</span>

node2.<span class="hljs-constant">GUID</span>.internal | <span class="hljs-constant">SUCCESS</span> | rc=<span class="hljs-number">0</span> <span class="hljs-prompt">&gt;&gt;
 </span><span class="hljs-constant">Version</span><span class="hljs-symbol">:</span>         <span class="hljs-number">1.13</span>.<span class="hljs-number">1</span>
 <span class="hljs-constant">Version</span><span class="hljs-symbol">:</span>         <span class="hljs-number">1.13</span>.<span class="hljs-number">1</span>

node3.<span class="hljs-constant">GUID</span>.internal | <span class="hljs-constant">SUCCESS</span> | rc=<span class="hljs-number">0</span> <span class="hljs-prompt">&gt;&gt;
 </span><span class="hljs-constant">Version</span><span class="hljs-symbol">:</span>         <span class="hljs-number">1.13</span>.<span class="hljs-number">1</span>
 <span class="hljs-constant">Version</span><span class="hljs-symbol">:</span>         <span class="hljs-number">1.13</span>.<span class="hljs-number">1</span>

node1.<span class="hljs-constant">GUID</span>.internal | <span class="hljs-constant">SUCCESS</span> | rc=<span class="hljs-number">0</span> <span class="hljs-prompt">&gt;&gt;
 </span><span class="hljs-constant">Version</span><span class="hljs-symbol">:</span>         <span class="hljs-number">1.13</span>.<span class="hljs-number">1</span>
 <span class="hljs-constant">Version</span><span class="hljs-symbol">:</span>         <span class="hljs-number">1.13</span>.<span class="hljs-number">1</span></code></pre></div></div></li></ol></div></div>
<div class="sect2"><h3 id="_verify_yum_repositories_and_nfs_shared_volumes_on_hosts">2.3. Verify Yum Repositories and NFS Shared Volumes on Hosts</h3><div class="paragraph"><p>The required yum repositories and NFS shared volumes are already set up on the environment. In this section you verify that they are set up properly.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>List the repositories on the <code>bastion</code> host:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs">yum repolist</code></pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="highlight nowrap"><code class="text language-text hljs objectivec">Loaded plugins: amazon-<span class="hljs-keyword">id</span>, rhui-lb, search-disabled-repos
repo <span class="hljs-keyword">id</span>                                                                                                                 repo name                                                                                                             status
rh-gluster-<span class="hljs-number">3</span>-client-<span class="hljs-keyword">for</span>-rhel-<span class="hljs-number">7</span>-server-rpms                                                                              Red Hat Gluster Client RPMS                                                                                              <span class="hljs-number">163</span>
rhel-<span class="hljs-number">7</span>-fast-datapath-rpms                                                                                               Red Hat Enterprise Linux <span class="hljs-number">7</span> Fast Datapath                                                                                  <span class="hljs-number">76</span>
rhel-<span class="hljs-number">7</span>-server-ansible-<span class="hljs-number">2.4</span>-rpms                                                                                          Red Hat Enterprise Linux <span class="hljs-number">7</span> Ansible RPMS                                                                                   <span class="hljs-number">19</span>
rhel-<span class="hljs-number">7</span>-server-extras-rpms                                                                                               Red Hat Enterprise Linux <span class="hljs-number">7</span> Extras                                                                                        <span class="hljs-number">838</span>
rhel-<span class="hljs-number">7</span>-server-optional-rpms                                                                                             Red Hat Enterprise Linux <span class="hljs-number">7</span> Optional                                                                                   <span class="hljs-number">15</span>,<span class="hljs-number">105</span>
rhel-<span class="hljs-number">7</span>-server-ose-<span class="hljs-number">3.9</span>-rpms                                                                                              Red Hat Enterprise Linux <span class="hljs-number">7</span> OSE <span class="hljs-number">3.9</span>                                                                                       <span class="hljs-number">610</span>
rhel-<span class="hljs-number">7</span>-server-rh-common-rpms                                                                                            Red Hat Enterprise Linux <span class="hljs-number">7</span> Common                                                                                        <span class="hljs-number">232</span>
rhel-<span class="hljs-number">7</span>-server-rpms                                                                                                      Red Hat Enterprise Linux <span class="hljs-number">7</span>                                                                                            <span class="hljs-number">20</span>,<span class="hljs-number">490</span>
repolist: <span class="hljs-number">37</span>,<span class="hljs-number">533</span></code></pre></div></div></li><li><p>List the repositories on all the other hosts:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs">ansible all -m shell <span class="hljs-operator">-a</span><span class="hljs-string">"yum repolist"</span></code></pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="highlight"><code class="text language-text hljs ruby">[<span class="hljs-constant">WARNING</span>]<span class="hljs-symbol">:</span> <span class="hljs-constant">Consider</span> using yum <span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">rather</span> <span class="hljs-title">than</span> <span class="hljs-title">running</span> <span class="hljs-title">yum</span></span>

infranode1.<span class="hljs-constant">GUID</span>.internal | <span class="hljs-constant">SUCCESS</span> | rc=<span class="hljs-number">0</span> <span class="hljs-prompt">&gt;&gt;
</span><span class="hljs-constant">Loaded</span> <span class="hljs-symbol">plugins:</span> amazon-id, rhui-lb, search-disabled-repos
repo id                                                                                                                 repo name                                                                                                             status
rh-gluster-<span class="hljs-number">3</span>-client-<span class="hljs-keyword">for</span>-rhel-<span class="hljs-number">7</span>-server-rpms                                                                              <span class="hljs-constant">Red</span> <span class="hljs-constant">Hat</span> <span class="hljs-constant">Gluster</span> <span class="hljs-constant">Client</span> <span class="hljs-constant">RPMS</span>                                                                                              <span class="hljs-number">163</span>
rhel-<span class="hljs-number">7</span>-fast-datapath-rpms                                                                                               <span class="hljs-constant">Red</span> <span class="hljs-constant">Hat</span> <span class="hljs-constant">Enterprise</span> <span class="hljs-constant">Linux</span> <span class="hljs-number">7</span> <span class="hljs-constant">Fast</span> <span class="hljs-constant">Datapath</span>                                                                                  <span class="hljs-number">76</span>
rhel-<span class="hljs-number">7</span>-server-ansible-<span class="hljs-number">2.4</span>-rpms                                                                                          <span class="hljs-constant">Red</span> <span class="hljs-constant">Hat</span> <span class="hljs-constant">Enterprise</span> <span class="hljs-constant">Linux</span> <span class="hljs-number">7</span> <span class="hljs-constant">Ansible</span> <span class="hljs-constant">RPMS</span>                                                                                   <span class="hljs-number">19</span>
rhel-<span class="hljs-number">7</span>-server-extras-rpms                                                                                               <span class="hljs-constant">Red</span> <span class="hljs-constant">Hat</span> <span class="hljs-constant">Enterprise</span> <span class="hljs-constant">Linux</span> <span class="hljs-number">7</span> <span class="hljs-constant">Extras</span>                                                                                        <span class="hljs-number">838</span>
rhel-<span class="hljs-number">7</span>-server-optional-rpms                                                                                             <span class="hljs-constant">Red</span> <span class="hljs-constant">Hat</span> <span class="hljs-constant">Enterprise</span> <span class="hljs-constant">Linux</span> <span class="hljs-number">7</span> <span class="hljs-constant">Optional</span>                                                                                   <span class="hljs-number">15</span>,<span class="hljs-number">105</span>
rhel-<span class="hljs-number">7</span>-server-ose-<span class="hljs-number">3.9</span>-rpms                                                                                              <span class="hljs-constant">Red</span> <span class="hljs-constant">Hat</span> <span class="hljs-constant">Enterprise</span> <span class="hljs-constant">Linux</span> <span class="hljs-number">7</span> <span class="hljs-constant">OSE</span> <span class="hljs-number">3.9</span>                                                                                       <span class="hljs-number">610</span>
rhel-<span class="hljs-number">7</span>-server-rh-common-rpms                                                                                            <span class="hljs-constant">Red</span> <span class="hljs-constant">Hat</span> <span class="hljs-constant">Enterprise</span> <span class="hljs-constant">Linux</span> <span class="hljs-number">7</span> <span class="hljs-constant">Common</span>                                                                                        <span class="hljs-number">232</span>
rhel-<span class="hljs-number">7</span>-server-rpms                                                                                                      <span class="hljs-constant">Red</span> <span class="hljs-constant">Hat</span> <span class="hljs-constant">Enterprise</span> <span class="hljs-constant">Linux</span> <span class="hljs-number">7</span>                                                                                            <span class="hljs-number">20</span>,<span class="hljs-number">490</span>
<span class="hljs-symbol">repolist:</span> <span class="hljs-number">37</span>,<span class="hljs-number">533</span>

infranode2.<span class="hljs-constant">GUID</span>.internal | <span class="hljs-constant">SUCCESS</span> | rc=<span class="hljs-number">0</span> <span class="hljs-prompt">&gt;&gt;
</span>[...]</code></pre></div></div></li><li><p>Examine the NFS server to see which NFS volumes are shared:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs">ansible nfs -m shell <span class="hljs-operator">-a</span><span class="hljs-string">"exportfs"</span></code></pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="highlight"><code class="text language-text hljs ruby">support1.<span class="hljs-constant">GUID</span>.internal | <span class="hljs-constant">SUCCESS</span> | rc=<span class="hljs-number">0</span> <span class="hljs-prompt">&gt;&gt;
</span>/srv/nfs      	&lt;world&gt;</code></pre></div></div></li></ol></div></div></div></div>
<div class="sect1"><h2 id="_deploy_highly_available_openshift_cluster">3. Deploy Highly Available OpenShift Cluster</h2><div class="sectionbody"><div class="paragraph"><p>In this section, you use the Ansible advanced installer to deploy OpenShift as a clustered, highly available installation that includes a load balancer in front of the API servers. The environment includes three masters, two infra nodes, three worker nodes, and the load balancer.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>On the <code>bastion</code> host, install the <code>atomic-openshift-utils</code> and <code>atomic-openshift-clients</code> package, which includes the installer and has Ansible and the playbooks as dependencies. You may find that this package is already installed.</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="text language-text hljs nginx"><span class="hljs-title">yum</span> -y install atomic-openshift-utils atomic-openshift-clients</code></pre></div></div></li></ol></div>
<div class="sect2"><h3 id="_requirements_for_openshift_deployment">3.1. Requirements for OpenShift Deployment</h3><div class="paragraph"><p>The <code>/etc/ansible/hosts</code> Ansible inventory file is used to define and configure the OpenShift cluster.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Your OpenShift cluster is expected to have the following characteristics as defined in the inventory file:</p><div class="ulist"><ul><li><p>Three master hosts in the deployment</p></li><li><p>A load balancer to access the masters</p></li><li><p>Two infra nodes, each running a router</p></li><li><p>LDAP authentication (see below for details)</p></li><li><p>An integrated registry pod backed by a persistent volume (PV) storage (NFS)</p></li><li><p>Router pods deployed, configured, and running on each infranode in the cluster</p></li><li><p>Aggregated logging configured and working</p></li><li><p>Metrics collection configured and working</p></li><li><p>Worker nodes labeled as <code>env=app</code> and infra nodes labeled as <code>env=infra</code></p></li><li><p>All infrastructure components (router, registry, logging, metrics, service brokers) running on infranodes</p></li><li><p>A <code>*.apps.${GUID}.example.opentlc.com</code> wildcard DNS entry that points to the infra nodes</p></li><li><p>The load balancer configured with <code>loadbalancer.${GUID}.example.opentlc.com</code> as the external DNS entry</p></li></ul></div></li></ol></div></div>
<div class="sect2"><h3 id="_basic_required_ansible_inventory_parameters">3.2. Basic Required Ansible Inventory Parameters</h3><div class="olist arabic"><ol class="arabic"><li><p>On the bastion, edit your <code>/etc/ansible/hosts</code> Ansible inventory file for the deployment. Use the following hints to set up your hosts file correctly:</p><div class="ulist"><ul><li><p>Minimum Variable Settings:</p><div class="ulist"><ul><li><p><code>deployment_type=</code> ???</p></li><li><p><code>containerized=</code> ???</p></li><li><p><code>openshift_master_cluster_method=</code> ???</p></li><li><p><code>openshift_master_cluster_hostname=</code> ???</p></li><li><p><code>openshift_master_cluster_public_hostname=</code> ???</p></li><li><p><code>openshift_master_default_subdomain=</code> ???</p></li></ul></div></li></ul></div></li></ol></div></div>
<div class="sect2"><h3 id="_configure_authentication_against_ipa_ldap_server">3.3. Configure Authentication Against IPA (LDAP) Server</h3><div class="paragraph"><p>In this section, you mainly edit the Ansible inventory file to configure the OpenShift master API servers to authenticate against an existing IPA (LDAP) server.  After installation by the <code>openshift-ansible</code> deployer is complete,, you will and synchronize or create OpenShift group objects to match the groups that are configured in IPA.</p></div>
<div class="sect3"><h4 id="_distribute_identity_management_idm_certificate_authority_certificates">3.3.1. Distribute Identity Management (IdM) Certificate Authority Certificates</h4><div class="paragraph"><p>The IPA server sets up its own Certificate Authority (CA) and does not use the same CA as your RHOCP installation. In order for RHOCP to make secured LDAP requests to the IPA server, your master servers need the CA certificate.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>On the <code>bastion</code> host, download the <code>ca.crt</code> file:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs"><span class="hljs-built_in">cd</span> /root
wget http://ipa.shared.example.opentlc.com/ipa/config/ca.crt -O /root/ipa-ca.crt</code></pre></div></div></li></ol></div></div>
<div class="sect3"><h4 id="_set_up_ipa_as_authentication_provider">3.3.2. Set Up IPA as Authentication Provider</h4><div class="olist arabic"><ol class="arabic"><li><p>Configure LDAP authentication using the Ansible installer. Use the following information to set up the authentication provider in the Ansible inventory file.:</p><div class="ulist"><ul><li><p><strong>bindDN</strong>: <code>uid=admin,cn=users,cn=accounts,dc=shared,dc=example,dc=opentlc,dc=com</code></p></li><li><p><strong>bindPassword</strong>: <code>r3dh4t1!</code></p></li><li><p><strong>ca</strong>: <code>/etc/origin/master/ipa-ca.crt</code></p></li><li><p><strong>url</strong>:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="text language-text hljs cpp">ldaps:<span class="hljs-comment">//ipa.shared.example.opentlc.com:636/cn=users,cn=accounts,dc=shared,dc=example,dc=opentlc,dc=com?uid?sub?(memberOf=cn=ocp-users,cn=groups,cn=accounts,dc=shared,dc=example,dc=opentlc,dc=com)</span></code></pre></div></div></li></ul></div></li><li><p>Use the <code>openshift_master_ldap_ca_file</code> variable to copy the certificate to the masters.</p></li><li><p>Make sure that your <code>/etc/ansible/hosts</code> file contains the following in the <code>[OSEv3:vars]</code> section.  Make sure the file does not contain any other values for <code>openshift_master_identity_provider</code>:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="text language-text hljs javascript">openshift_master_identity_providers=[{<span class="hljs-string">'name'</span>: <span class="hljs-string">'ldap'</span>, <span class="hljs-string">'challenge'</span>: <span class="hljs-string">'true'</span>, <span class="hljs-string">'login'</span>: <span class="hljs-string">'true'</span>, <span class="hljs-string">'kind'</span>: <span class="hljs-string">'LDAPPasswordIdentityProvider'</span>,<span class="hljs-string">'attributes'</span>: {<span class="hljs-string">'id'</span>: [<span class="hljs-string">'dn'</span>], <span class="hljs-string">'email'</span>: [<span class="hljs-string">'mail'</span>], <span class="hljs-string">'name'</span>: [<span class="hljs-string">'cn'</span>], <span class="hljs-string">'preferredUsername'</span>: [<span class="hljs-string">'uid'</span>]}, <span class="hljs-string">'bindDN'</span>: <span class="hljs-string">'uid=admin,cn=users,cn=accounts,dc=shared,dc=example,dc=opentlc,dc=com'</span>, <span class="hljs-string">'bindPassword'</span>: <span class="hljs-string">'r3dh4t1!'</span>, <span class="hljs-string">'ca'</span>: <span class="hljs-string">'/etc/origin/master/ipa-ca.crt'</span>,<span class="hljs-string">'insecure'</span>: <span class="hljs-string">'false'</span>, <span class="hljs-string">'url'</span>: <span class="hljs-string">'ldaps://ipa.shared.example.opentlc.com:636/cn=users,cn=accounts,dc=shared,dc=example,dc=opentlc,dc=com?uid?sub?(memberOf=cn=ocp-users,cn=groups,cn=accounts,dc=shared,dc=example,dc=opentlc,dc=com)'</span>}]

openshift_master_ldap_ca_file=<span class="hljs-regexp">/root/i</span>pa-ca.crt</code></pre></div></div></li></ol></div></div>
<div class="sect3"><h4 id="_openshift_hosted_components_requirements">3.3.3. OpenShift Hosted Components Requirements</h4><div class="olist arabic"><ol class="arabic"><li><p>Continue to edit your Ansible inventory file.  Now address supporting hosted components.</p><div class="ulist"><ul><li><p><code>openshift_hosted_infra_selector=</code> ???</p><div class="ulist"><ul><li><p>Default node selector for infra components (<strong>ONLY</strong> for router/registry/template service broker/ansible service broker)</p><div class="admonitionblock caution"><table><tbody><tr><td class="icon"><i class="icon-caution" title="Caution"></i></td><td class="content">Watch for Node Selectors! Because you are deploying a cluster with custom node labels (<code>env=infra</code>) rather than using the default (<code>region=infra</code>) <strong>all</strong> components need explicit Node Selectors!</td></tr></tbody></table></div></li></ul></div></li><li><p>Logging Components: Elasticsearch, Kibana, Logging Curator</p><div class="ulist"><ul><li><p>Find the several proper parameters for logging and its associated storage</p></li></ul></div></li><li><p>Metrics Components: Cassandra, Hawkular, Heapster</p><div class="ulist"><ul><li><p>Find the several proper parameters for metrics and its associated storage</p></li></ul></div></li><li><p>Serivce Catalog Components: API server, Template Service Broker, Ansible Broker</p><div class="ulist"><ul><li><p>Find the several proper parameters for the service catalog and its associated storage</p></li></ul></div></li><li><p>Prometheus components if you chose to install them</p></li></ul></div></li></ol></div>
<div class="admonitionblock caution"><table><tbody><tr><td class="icon"><i class="icon-caution" title="Caution"></i></td><td class="content"> Do <strong>NOT</strong> enable any of the <code>[glusterfs]</code> nodes. Enabling Container Native Storage will be part of a later exercise.
* When configuring storage for any components (Logging, Metrics, etc.) make sure that the storage is created in <code>/srv/nfs</code> on the NFS server because this directory is backed by a separate volume group.</td></tr></tbody></table></div>
<div class="admonitionblock tip"><table><tbody><tr><td class="icon"><i class="icon-tip" title="Tip"></i></td><td class="content">There is a fully populated and working solution hosts file in <code>/var/preserve/hosts</code> available on your bastion to consult.</td></tr></tbody></table></div></div></div>
<div class="sect2"><h3 id="_execute_the_code_openshift_ansible_code_deployer">3.4. Execute the <code>openshift-ansible</code> Deployer</h3><div class="olist arabic"><ol class="arabic"><li><p>Run <code>ansible-playbook</code> to check that all prerequisites are met. This should take less than 5 minues.</p><div class="admonitionblock tip"><table><tbody><tr><td class="icon"><i class="icon-tip" title="Tip"></i></td><td class="content">Use <code>tmux</code> <strong>before</strong> any ansible-playbook runs: <a href="https://tmuxcheatsheet.com/">https://tmuxcheatsheet.com</a>. If you want to be able to scroll in tmux window use Ctrl-B [ and Ctrl-B q to quit scroll mode. On a Mac use iTerm2 (<a href="https://www.iterm2.com/">https://www.iterm2.com</a>) and then you can use "tmux -CC" to create a secondary tab with full scrollback etc.</td></tr></tbody></table></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs">ansible-playbook <span class="hljs-operator">-f</span> <span class="hljs-number">20</span> /usr/share/ansible/openshift-ansible/playbooks/prerequisites.yml</code></pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="highlight"><code class="text language-text hljs markdown">[...]

PLAY RECAP <span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-emphasis">***</span>
infranode1.GUID.internal   : ok=61   changed=13   unreachable=0    failed=0
infranode2.GUID.internal   : ok=61   changed=13   unreachable=0    failed=0
loadbalancer1.GUID.internal: ok=37   changed=4    unreachable=0    failed=0
localhost                  : ok=13   changed=0    unreachable=0    failed=0
master1.GUID.internal      : ok=62   changed=13   unreachable=0    failed=0
master2.GUID.internal      : ok=62   changed=13   unreachable=0    failed=0
master3.GUID.internal      : ok=68   changed=14   unreachable=0    failed=0
node1.GUID.internal        : ok=61   changed=13   unreachable=0    failed=0
node2.GUID.internal        : ok=61   changed=13   unreachable=0    failed=0
node3.GUID.internal        : ok=61   changed=13   unreachable=0    failed=0
support1.GUID.internal     : ok=35   changed=4    unreachable=0    failed=0

INSTALLER STATUS <span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span>**
Initialization             : Complete (0:00:27)</code></pre></div></div></li><li><p>Run <code>ansible-playbook</code> to deploy your cluster. This will take about 30 minutes.</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs">ansible-playbook <span class="hljs-operator">-f</span> <span class="hljs-number">20</span> /usr/share/ansible/openshift-ansible/playbooks/deploy_cluster.yml</code></pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="highlight"><code class="text language-text hljs markdown">[...]

PLAY RECAP
infranode1.GUID.internal   : ok=135  changed=52   unreachable=0    failed=0
infranode2.GUID.internal   : ok=135  changed=52   unreachable=0    failed=0
loadbalancer1.GUID.internal: ok=63   changed=10   unreachable=0    failed=0
localhost                  : ok=14   changed=0    unreachable=0    failed=0
master1.GUID.internal      : ok=339  changed=137  unreachable=0    failed=0
master2.GUID.internal      : ok=339  changed=137  unreachable=0    failed=0
master3.GUID.internal      : ok=1056 changed=415  unreachable=0    failed=0
node1.GUID.internal        : ok=135  changed=52   unreachable=0    failed=0
node2.GUID.internal        : ok=135  changed=52   unreachable=0    failed=0
node3.GUID.internal        : ok=135  changed=52   unreachable=0    failed=0
support1.GUID.internal     : ok=33   changed=7    unreachable=0    failed=0

INSTALLER STATUS <span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span>
Initialization             : Complete (0:00:26)
Health Check               : Complete (0:00:08)
etcd Install               : Complete (0:01:05)
NFS Install                : Complete (0:00:14)
Load balancer Install      : Complete (0:00:15)
Master Install             : Complete (0:09:32)
Master Additional Install  : Complete (0:00:52)
Node Install               : Complete (0:04:11)
Hosted Install             : Complete (0:01:14)
Web Console Install        : Complete (0:00:24)
Metrics Install            : Complete (0:02:02)
Logging Install            : Complete (0:03:50)
Prometheus Install         : Complete (0:00:51)
Service Catalog Install    : Complete (0:01:54)</code></pre></div></div>
<div class="admonitionblock warning"><table><tbody><tr><td class="icon"><i class="icon-warning" title="Warning"></i></td><td class="content">If your installation fails you will need to uninstall OpenShift using the uninstall playbook and start the installation from the beginning including checking the prerequisites! See <a href="https://docs.openshift.com/container-platform/3.9/install_config/install/advanced_install.html#installer-known-issues">https://docs.openshift.com/container-platform/3.9/install_config/install/advanced_install.html#installer-known-issues</a></td></tr></tbody></table></div></li></ol></div></div>
<div class="sect2"><h3 id="_uninstalling_openshift">3.5. Uninstalling OpenShift</h3><div class="paragraph"><p>In case you need to uninstall OpenShift follow the instructions at <a href="https://docs.openshift.com/container-platform/3.9/install_config/install/advanced_install.html#uninstalling-advanced">https://docs.openshift.com/container-platform/3.9/install_config/install/advanced_install.html#uninstalling-advanced</a>.</p></div>
<div class="paragraph"><p>Run the uninstall playbook:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs">ansible-playbook /usr/share/ansible/openshift-ansible/playbooks/adhoc/uninstall.yml</code></pre></div></div>
<div class="paragraph"><p>After the uninstallation completes it is also usually necessary to delete all left over content (certificates etc.) in the /etc/origin directories on all masters and nodes.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs">ansible nodes <span class="hljs-operator">-a</span> <span class="hljs-string">"rm -rf /etc/origin"</span></code></pre></div></div>
<div class="paragraph"><p>It is also necessary to delete all data from the NFS Server.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs">ansible nfs <span class="hljs-operator">-a</span> <span class="hljs-string">"rm -rf /srv/nfs/*"</span></code></pre></div></div></div></div></div>
<div class="sect1"><h2 id="_verify_openshift_cluster">4. Verify OpenShift Cluster</h2><div class="sectionbody"><div class="paragraph"><p>In this section, you will ensure that the proper configuration and components have been deployed in accord your ansible Inventory file.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Once the installation is complete copy the .kube directory from master1 to your bastion. That way you can run oc commands as <code>system:admin</code> on the bastion and don’t have to ssh to a master:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs">ansible masters[<span class="hljs-number">0</span>] -b -m fetch <span class="hljs-operator">-a</span> <span class="hljs-string">"src=/root/.kube/config dest=/root/.kube/config flat=yes"</span></code></pre></div></div></li><li><p>Verify that you are now <code>system:admin</code>:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs">oc whoami</code></pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="highlight"><code class="text language-text hljs css"><span class="hljs-tag">system</span><span class="hljs-pseudo">:admin</span></code></pre></div></div></li></ol></div>
<div class="sect2"><h3 id="_verify_configuration">4.1. Verify Configuration</h3><div class="olist arabic"><ol class="arabic"><li><p>Run <code>oc get nodes</code> to display the nodes:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs">oc get nodes --show-labels</code></pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="highlight nowrap"><code class="text language-text hljs cs">NAME                       STATUS    ROLES     AGE       VERSION             LABELS
infranode1.GUID.<span class="hljs-keyword">internal</span>   Ready     &lt;none&gt;    <span class="hljs-number">12</span>m       v1<span class="hljs-number">.9</span><span class="hljs-number">.1</span>+a0ce1bc657   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,cluster=GUID,env=infra,kubernetes.io/hostname=infranode1.GUID.<span class="hljs-keyword">internal</span>,logging-infra-fluentd=<span class="hljs-keyword">true</span>,zone=eu-central-<span class="hljs-number">1</span>a
infranode2.GUID.<span class="hljs-keyword">internal</span>   Ready     &lt;none&gt;    <span class="hljs-number">12</span>m       v1<span class="hljs-number">.9</span><span class="hljs-number">.1</span>+a0ce1bc657   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,cluster=GUID,env=infra,kubernetes.io/hostname=infranode2.GUID.<span class="hljs-keyword">internal</span>,logging-infra-fluentd=<span class="hljs-keyword">true</span>,zone=eu-central-<span class="hljs-number">1</span>a
master1.GUID.<span class="hljs-keyword">internal</span>      Ready     master    <span class="hljs-number">12</span>m       v1<span class="hljs-number">.9</span><span class="hljs-number">.1</span>+a0ce1bc657   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,cluster=GUID,env=master,kubernetes.io/hostname=master1.GUID.<span class="hljs-keyword">internal</span>,logging-infra-fluentd=<span class="hljs-keyword">true</span>,node-role.kubernetes.io/master=<span class="hljs-keyword">true</span>,openshift-infra=apiserver,zone=eu-central-<span class="hljs-number">1</span>a
master2.GUID.<span class="hljs-keyword">internal</span>      Ready     master    <span class="hljs-number">12</span>m       v1<span class="hljs-number">.9</span><span class="hljs-number">.1</span>+a0ce1bc657   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,cluster=GUID,env=master,kubernetes.io/hostname=master2.GUID.<span class="hljs-keyword">internal</span>,logging-infra-fluentd=<span class="hljs-keyword">true</span>,node-role.kubernetes.io/master=<span class="hljs-keyword">true</span>,zone=eu-central-<span class="hljs-number">1</span>a
master3.GUID.<span class="hljs-keyword">internal</span>      Ready     master    <span class="hljs-number">12</span>m       v1<span class="hljs-number">.9</span><span class="hljs-number">.1</span>+a0ce1bc657   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,cluster=GUID,env=master,kubernetes.io/hostname=master3.GUID.<span class="hljs-keyword">internal</span>,logging-infra-fluentd=<span class="hljs-keyword">true</span>,node-role.kubernetes.io/master=<span class="hljs-keyword">true</span>,zone=eu-central-<span class="hljs-number">1</span>a
node1.GUID.<span class="hljs-keyword">internal</span>        Ready     compute   <span class="hljs-number">12</span>m       v1<span class="hljs-number">.9</span><span class="hljs-number">.1</span>+a0ce1bc657   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,cluster=GUID,env=app,kubernetes.io/hostname=node1.GUID.<span class="hljs-keyword">internal</span>,logging-infra-fluentd=<span class="hljs-keyword">true</span>,node-role.kubernetes.io/compute=<span class="hljs-keyword">true</span>,zone=eu-central-<span class="hljs-number">1</span>a
node2.GUID.<span class="hljs-keyword">internal</span>        Ready     compute   <span class="hljs-number">12</span>m       v1<span class="hljs-number">.9</span><span class="hljs-number">.1</span>+a0ce1bc657   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,cluster=GUID,env=app,kubernetes.io/hostname=node2.GUID.<span class="hljs-keyword">internal</span>,logging-infra-fluentd=<span class="hljs-keyword">true</span>,node-role.kubernetes.io/compute=<span class="hljs-keyword">true</span>,zone=eu-central-<span class="hljs-number">1</span>a
node3.GUID.<span class="hljs-keyword">internal</span>        Ready     compute   <span class="hljs-number">12</span>m       v1<span class="hljs-number">.9</span><span class="hljs-number">.1</span>+a0ce1bc657   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,cluster=GUID,env=app,kubernetes.io/hostname=node3.GUID.<span class="hljs-keyword">internal</span>,logging-infra-fluentd=<span class="hljs-keyword">true</span>,node-role.kubernetes.io/compute=<span class="hljs-keyword">true</span>,zone=eu-central-<span class="hljs-number">1</span>a</code></pre></div></div></li><li><p>Validate that all pods are running (none are pending) and on the correct nodes.</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs">oc get pod --all-namespaces -o wide</code></pre></div></div>
<div class="listingblock"><div class="title">Sample Output for a fully configured OpenShift cluster</div><div class="content"><pre class="highlight nowrap"><code class="text language-text hljs cs">NAMESPACE                           NAME                                      READY     STATUS    RESTARTS   AGE       IP              NODE
<span class="hljs-keyword">default</span>                             docker-registry-<span class="hljs-number">1</span>-<span class="hljs-number">9</span>tfnm                   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">0</span>          <span class="hljs-number">10</span>m       <span class="hljs-number">10.128</span><span class="hljs-number">.0</span><span class="hljs-number">.3</span>      infranode1.GUID.<span class="hljs-keyword">internal</span>
<span class="hljs-keyword">default</span>                             registry-console-<span class="hljs-number">1</span>-<span class="hljs-number">4</span>thqf                  <span class="hljs-number">1</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">0</span>          <span class="hljs-number">9</span>m        <span class="hljs-number">10.130</span><span class="hljs-number">.0</span><span class="hljs-number">.2</span>      node3.GUID.<span class="hljs-keyword">internal</span>
<span class="hljs-keyword">default</span>                             router-<span class="hljs-number">1</span>-jjz8n                            <span class="hljs-number">1</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">0</span>          <span class="hljs-number">10</span>m       <span class="hljs-number">192.199</span><span class="hljs-number">.0</span><span class="hljs-number">.188</span>   infranode1.GUID.<span class="hljs-keyword">internal</span>
<span class="hljs-keyword">default</span>                             router-<span class="hljs-number">1</span>-tnwlx                            <span class="hljs-number">1</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">0</span>          <span class="hljs-number">10</span>m       <span class="hljs-number">192.199</span><span class="hljs-number">.0</span><span class="hljs-number">.221</span>   infranode2.GUID.<span class="hljs-keyword">internal</span>
kube-service-catalog                apiserver-jxcl2                           <span class="hljs-number">1</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">0</span>          <span class="hljs-number">2</span>m        <span class="hljs-number">10.131</span><span class="hljs-number">.0</span><span class="hljs-number">.5</span>      master1.GUID.<span class="hljs-keyword">internal</span>
kube-service-catalog                controller-manager-<span class="hljs-number">22</span>qrk                  <span class="hljs-number">1</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">0</span>          <span class="hljs-number">2</span>m        <span class="hljs-number">10.131</span><span class="hljs-number">.0</span><span class="hljs-number">.4</span>      master1.GUID.<span class="hljs-keyword">internal</span>
logging                             logging-curator-<span class="hljs-number">1</span>-lkknp                   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">0</span>          <span class="hljs-number">4</span>m        <span class="hljs-number">10.128</span><span class="hljs-number">.0</span><span class="hljs-number">.7</span>      infranode1.GUID.<span class="hljs-keyword">internal</span>
logging                             logging-es-data-master-rx1fda95-<span class="hljs-number">1</span>-<span class="hljs-number">66</span>l6k   <span class="hljs-number">2</span>/<span class="hljs-number">2</span>       Running   <span class="hljs-number">0</span>          <span class="hljs-number">3</span>m        <span class="hljs-number">10.128</span><span class="hljs-number">.0</span><span class="hljs-number">.9</span>      infranode1.GUID.<span class="hljs-keyword">internal</span>
logging                             logging-fluentd-<span class="hljs-number">4</span>mjx4                     <span class="hljs-number">1</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">0</span>          <span class="hljs-number">4</span>m        <span class="hljs-number">10.130</span><span class="hljs-number">.0</span><span class="hljs-number">.3</span>      node3.GUID.<span class="hljs-keyword">internal</span>
logging                             logging-fluentd-<span class="hljs-number">5</span>qlcn                     <span class="hljs-number">1</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">0</span>          <span class="hljs-number">4</span>m        <span class="hljs-number">10.129</span><span class="hljs-number">.0</span><span class="hljs-number">.4</span>      master2.GUID.<span class="hljs-keyword">internal</span>
logging                             logging-fluentd-<span class="hljs-number">8</span>wbx9                     <span class="hljs-number">1</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">0</span>          <span class="hljs-number">4</span>m        <span class="hljs-number">10.131</span><span class="hljs-number">.0</span><span class="hljs-number">.3</span>      master1.GUID.<span class="hljs-keyword">internal</span>
logging                             logging-fluentd-czjrn                     <span class="hljs-number">1</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">0</span>          <span class="hljs-number">4</span>m        <span class="hljs-number">10.131</span><span class="hljs-number">.2</span><span class="hljs-number">.2</span>      node1.GUID.<span class="hljs-keyword">internal</span>
logging                             logging-fluentd-nbdmh                     <span class="hljs-number">1</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">0</span>          <span class="hljs-number">4</span>m        <span class="hljs-number">10.128</span><span class="hljs-number">.0</span><span class="hljs-number">.8</span>      infranode1.GUID.<span class="hljs-keyword">internal</span>
logging                             logging-fluentd-r876d                     <span class="hljs-number">1</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">0</span>          <span class="hljs-number">4</span>m        <span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.3</span>      master3.GUID.<span class="hljs-keyword">internal</span>
logging                             logging-fluentd-t5gf8                     <span class="hljs-number">1</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">0</span>          <span class="hljs-number">4</span>m        <span class="hljs-number">10.130</span><span class="hljs-number">.2</span><span class="hljs-number">.8</span>      infranode2.GUID.<span class="hljs-keyword">internal</span>
logging                             logging-fluentd-z45b7                     <span class="hljs-number">1</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">0</span>          <span class="hljs-number">4</span>m        <span class="hljs-number">10.128</span><span class="hljs-number">.2</span><span class="hljs-number">.2</span>      node2.GUID.<span class="hljs-keyword">internal</span>
logging                             logging-kibana-<span class="hljs-number">1</span>-gfwpr                    <span class="hljs-number">2</span>/<span class="hljs-number">2</span>       Running   <span class="hljs-number">0</span>          <span class="hljs-number">4</span>m        <span class="hljs-number">10.130</span><span class="hljs-number">.2</span><span class="hljs-number">.6</span>      infranode2.GUID.<span class="hljs-keyword">internal</span>
openshift-ansible-service-broker    asb-<span class="hljs-number">1</span>-zz2mg                               <span class="hljs-number">1</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">1</span>          <span class="hljs-number">1</span>m        <span class="hljs-number">10.131</span><span class="hljs-number">.2</span><span class="hljs-number">.3</span>      node1.GUID.<span class="hljs-keyword">internal</span>
openshift-ansible-service-broker    asb-etcd-<span class="hljs-number">1</span>-<span class="hljs-number">9</span>xz4g                          <span class="hljs-number">1</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">0</span>          <span class="hljs-number">1</span>m        <span class="hljs-number">10.128</span><span class="hljs-number">.2</span><span class="hljs-number">.4</span>      node2.GUID.<span class="hljs-keyword">internal</span>
openshift-infra                     hawkular-cassandra-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>l22f                <span class="hljs-number">1</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">0</span>          <span class="hljs-number">7</span>m        <span class="hljs-number">10.128</span><span class="hljs-number">.0</span><span class="hljs-number">.5</span>      infranode1.GUID.<span class="hljs-keyword">internal</span>
openshift-infra                     hawkular-metrics-flbs5                    <span class="hljs-number">1</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">0</span>          <span class="hljs-number">7</span>m        <span class="hljs-number">10.130</span><span class="hljs-number">.2</span><span class="hljs-number">.4</span>      infranode2.GUID.<span class="hljs-keyword">internal</span>
openshift-infra                     heapster-r97pm                            <span class="hljs-number">1</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">0</span>          <span class="hljs-number">7</span>m        <span class="hljs-number">10.128</span><span class="hljs-number">.0</span><span class="hljs-number">.6</span>      infranode1.GUID.<span class="hljs-keyword">internal</span>
openshift-metrics                   prometheus-<span class="hljs-number">0</span>                              <span class="hljs-number">6</span>/<span class="hljs-number">6</span>       Running   <span class="hljs-number">0</span>          <span class="hljs-number">3</span>m        <span class="hljs-number">10.130</span><span class="hljs-number">.2</span><span class="hljs-number">.10</span>     infranode2.GUID.<span class="hljs-keyword">internal</span>
openshift-metrics                   prometheus-node-exporter-<span class="hljs-number">2</span>c554            <span class="hljs-number">1</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">0</span>          <span class="hljs-number">3</span>m        <span class="hljs-number">192.199</span><span class="hljs-number">.0</span><span class="hljs-number">.221</span>   infranode2.GUID.<span class="hljs-keyword">internal</span>
openshift-metrics                   prometheus-node-exporter-<span class="hljs-number">2</span>c9dq            <span class="hljs-number">1</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">0</span>          <span class="hljs-number">3</span>m        <span class="hljs-number">192.199</span><span class="hljs-number">.0</span><span class="hljs-number">.114</span>   node3.GUID.<span class="hljs-keyword">internal</span>
openshift-metrics                   prometheus-node-exporter-<span class="hljs-number">47</span>gfh            <span class="hljs-number">1</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">0</span>          <span class="hljs-number">3</span>m        <span class="hljs-number">192.199</span><span class="hljs-number">.0</span><span class="hljs-number">.128</span>   node2.GUID.<span class="hljs-keyword">internal</span>
openshift-metrics                   prometheus-node-exporter-<span class="hljs-number">5</span>nf98            <span class="hljs-number">1</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">0</span>          <span class="hljs-number">3</span>m        <span class="hljs-number">192.199</span><span class="hljs-number">.0</span><span class="hljs-number">.212</span>   master2.GUID.<span class="hljs-keyword">internal</span>
openshift-metrics                   prometheus-node-exporter-<span class="hljs-number">8</span>xhlk            <span class="hljs-number">1</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">0</span>          <span class="hljs-number">3</span>m        <span class="hljs-number">192.199</span><span class="hljs-number">.0</span><span class="hljs-number">.8</span>     master3.GUID.<span class="hljs-keyword">internal</span>
openshift-metrics                   prometheus-node-exporter-lxbfm            <span class="hljs-number">1</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">0</span>          <span class="hljs-number">3</span>m        <span class="hljs-number">192.199</span><span class="hljs-number">.0</span><span class="hljs-number">.126</span>   master1.GUID.<span class="hljs-keyword">internal</span>
openshift-metrics                   prometheus-node-exporter-wlx2d            <span class="hljs-number">1</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">0</span>          <span class="hljs-number">3</span>m        <span class="hljs-number">192.199</span><span class="hljs-number">.0</span><span class="hljs-number">.188</span>   infranode1.GUID.<span class="hljs-keyword">internal</span>
openshift-metrics                   prometheus-node-exporter-wxvss            <span class="hljs-number">1</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">0</span>          <span class="hljs-number">3</span>m        <span class="hljs-number">192.199</span><span class="hljs-number">.0</span><span class="hljs-number">.142</span>   node1.GUID.<span class="hljs-keyword">internal</span>
openshift-template-service-broker   apiserver-<span class="hljs-number">7</span>wtwn                           <span class="hljs-number">1</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">0</span>          <span class="hljs-number">1</span>m        <span class="hljs-number">10.130</span><span class="hljs-number">.2</span><span class="hljs-number">.11</span>     infranode2.GUID.<span class="hljs-keyword">internal</span>
openshift-template-service-broker   apiserver-hbqpb                           <span class="hljs-number">1</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">0</span>          <span class="hljs-number">1</span>m        <span class="hljs-number">10.128</span><span class="hljs-number">.0</span><span class="hljs-number">.10</span>     infranode1.GUID.<span class="hljs-keyword">internal</span>
openshift-web-console               webconsole-c9cf7f469-<span class="hljs-number">7</span>phd8                <span class="hljs-number">1</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">2</span>          <span class="hljs-number">9</span>m        <span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.2</span>      master3.GUID.<span class="hljs-keyword">internal</span>
openshift-web-console               webconsole-c9cf7f469-j27pc                <span class="hljs-number">1</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">2</span>          <span class="hljs-number">9</span>m        <span class="hljs-number">10.131</span><span class="hljs-number">.0</span><span class="hljs-number">.2</span>      master1.GUID.<span class="hljs-keyword">internal</span>
openshift-web-console               webconsole-c9cf7f469-xmfqb                <span class="hljs-number">1</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">2</span>          <span class="hljs-number">9</span>m        <span class="hljs-number">10.129</span><span class="hljs-number">.0</span><span class="hljs-number">.3</span>      master2.GUID.<span class="hljs-keyword">internal</span></code></pre></div></div></li></ol></div></div>
<div class="sect2"><h3 id="_verify_authentication_provider_configuration">4.2. Verify Authentication Provider Configuration</h3><div class="paragraph"><p>In this section, you verify the configuration of the authentication provider by attempting to log in to the master web console.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Navigate to the OpenShift Container Platform web console.</p></li><li><p>Log in using <code>payment1</code> as the username and <code>r3dh4t1!</code> as the password.</p></li><li><p>If you are unable to authenticate successfully, double-check your configuration.</p></li></ol></div></div>
<div class="sect2"><h3 id="_synchronize_groups_from_ipa_server_to_openshift_cluster">4.3. Synchronize Groups from IPA Server to OpenShift Cluster</h3><div class="olist arabic"><ol class="arabic"><li><p>Synchronize the following groups from the IPA server to your OpenShift cluster:</p><div class="ulist"><ul><li><p><code>group/portalapp</code></p></li><li><p><code>group/paymentapp</code></p></li><li><p><code>group/ocp-production</code></p></li><li><p><code>group/ocp-platform</code></p><div class="olist loweralpha"><ol class="loweralpha" type="a"><li><p>Use the following hints:</p><div class="ulist"><ul><li><p><strong>url</strong>: <code>ldap://ipa.shared.example.opentlc.com</code> or <code>ldaps://ipa.shared.example.opentlc.com:636</code></p></li><li><p><strong>ca</strong>: <code>/etc/origin/master/ipa-ca.crt</code></p></li><li><p><strong>bindDN</strong>: <code>uid=admin,cn=users,cn=accounts,dc=shared,dc=example,dc=opentlc,dc=com</code></p></li><li><p><strong>bindPassword</strong>: <code>r3dh4t1!</code></p></li><li><p><strong>baseDN</strong> for <strong>groupsQuery</strong>: <code>cn=groups,cn=accounts,dc=shared,dc=example,dc=opentlc,dc=com</code></p></li><li><p><strong>baseDN</strong> for <strong>usersQuery</strong>: <code>cn=users,cn=accounts,dc=shared,dc=example,dc=opentlc,dc=com</code></p></li><li><p><strong>filter</strong>:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="text language-text hljs markdown"> (&amp;(!(objectClass=mepManagedEntry))(!(cn=trust admins))(!(cn=groups))(!(cn=admins))(!(cn=ipausers))(!(cn=editors))(!(cn=ocp-users))(!(cn=evmgroup<span class="hljs-emphasis">*))(!(cn=ipac*</span>)))</code></pre></div></div></li><li><p>LDAP groups are referenced like this: <code>cn=portalapp,cn=groups,cn=accounts,dc=shared,dc=example,dc=opentlc,dc=com</code></p><div class="admonitionblock tip"><table><tbody><tr><td class="icon"><i class="icon-tip" title="Tip"></i></td><td class="content">The OPENTLC IPA server has a lot of groups defined. To limit the number of groups that are synced, set up a whitelist.</td></tr></tbody></table></div></li></ul></div></li><li><p>On the <code>master1</code> host, create the <code>/etc/origin/master/groupsync.yaml</code> file:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs">ssh master1.<span class="hljs-variable">$GUID</span>.internal
sudo -i

cat &lt;&lt; EOF &gt; /etc/origin/master/groupsync.yaml
kind: LDAPSyncConfig
apiVersion: v1
url: <span class="hljs-string">"ldap://ipa.shared.example.opentlc.com"</span>
insecure: <span class="hljs-literal">false</span>
ca: <span class="hljs-string">"/etc/origin/master/ipa-ca.crt"</span>
<span class="hljs-built_in">bind</span>DN: <span class="hljs-string">"uid=admin,cn=users,cn=accounts,dc=shared,dc=example,dc=opentlc,dc=com"</span>
<span class="hljs-built_in">bind</span>Password: <span class="hljs-string">"r3dh4t1!"</span>
rfc2307:
    groupsQuery:
        baseDN: <span class="hljs-string">"cn=groups,cn=accounts,dc=shared,dc=example,dc=opentlc,dc=com"</span>
        scope: sub
        derefAliases: never
        filter: (&amp;(!(objectClass=mepManagedEntry))(!(cn=trust admins))(!(cn=groups))(!(cn=admins))(!(cn=ipausers))(!(cn=editors))(!(cn=ocp-users))(!(cn=evmgroup*))(!(cn=ipac*)))
    groupUIDAttribute: dn
    groupNameAttributes: [ cn ]
    groupMembershipAttributes: [ member ]
    usersQuery:
        baseDN: <span class="hljs-string">"cn=users,cn=accounts,dc=shared,dc=example,dc=opentlc,dc=com"</span>
        scope: sub
        derefAliases: never
    userUIDAttribute: dn
    userNameAttributes: [ uid ]
EOF</code></pre></div></div></li><li><p>Map LDAP groups to specific names in RHOCP by adding this section to the file  <code>/etc/origin/master/groupsync.yaml</code>:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs"><span class="hljs-built_in">echo</span> <span class="hljs-string">'
groupUIDNameMapping:
  "cn=portalapp,cn=groups,cn=accounts,dc=shared,dc=example,dc=opentlc,dc=com": "portalapp"
  "cn=paymentapp,cn=groups,cn=accounts,dc=shared,dc=example,dc=opentlc,dc=com": "paymentapp"
  "cn=ocp-production,cn=groups,cn=accounts,dc=shared,dc=example,dc=opentlc,dc=com": "ocp-production"
  "cn=ocp-platform,cn=groups,cn=accounts,dc=shared,dc=example,dc=opentlc,dc=com": "ocp-platform"
  '</span> &gt;&gt;/etc/origin/master/groupsync.yaml</code></pre></div></div></li><li><p>Create the <code>/etc/origin/master/whitelist.yaml</code> file:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs">cat &lt;&lt; EOF &gt; /etc/origin/master/whitelist.yaml
cn=portalapp,cn=groups,cn=accounts,dc=shared,dc=example,dc=opentlc,dc=com
cn=paymentapp,cn=groups,cn=accounts,dc=shared,dc=example,dc=opentlc,dc=com
cn=ocp-platform,cn=groups,cn=accounts,dc=shared,dc=example,dc=opentlc,dc=com
cn=ocp-production,cn=groups,cn=accounts,dc=shared,dc=example,dc=opentlc,dc=com
EOF</code></pre></div></div></li></ol></div></li></ul></div></li></ol></div></div>
<div class="sect2"><h3 id="_test_run_group_synchronization_optional">4.4. Test Run Group Synchronization [ Optional ]</h3><div class="olist arabic"><ol class="arabic"><li><p>Still on the <code>master1</code> host, verify user IDs:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="text language-text hljs cs">oc <span class="hljs-keyword">get</span> users</code></pre></div></div></li><li><p>If there are users with the <code>htpasswd_auth</code> identity, delete them as shown in this example:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs">oc delete user andrew</code></pre></div></div></li><li><p>Delete any <code>htpasswd</code> identities as shown in this example:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs">oc delete identity htpassword:uid=andrew</code></pre></div></div></li><li><p>As a test, run the synchronization:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs">oc adm groups sync --sync-config=/etc/origin/master/groupsync.yaml --whitelist=/etc/origin/master/whitelist.yaml</code></pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="highlight"><code class="yaml language-yaml hljs coffeescript"><span class="hljs-attribute">apiVersion</span>: v1
<span class="hljs-attribute">items</span>:
- <span class="hljs-attribute">apiVersion</span>: v1
  <span class="hljs-attribute">kind</span>: Group
  <span class="hljs-attribute">metadata</span>:
    <span class="hljs-attribute">annotations</span>:
      openshift.io/ldap.sync-<span class="hljs-attribute">time</span>: <span class="hljs-number">2018</span>-<span class="hljs-number">04</span>-<span class="hljs-number">18</span><span class="hljs-attribute">T20</span>:<span class="hljs-number">32</span>:<span class="hljs-number">48</span>Z
      openshift.io/ldap.<span class="hljs-attribute">uid</span>: cn=portalapp,cn=groups,cn=accounts,dc=shared,dc=example,dc=opentlc,dc=com
      openshift.io/ldap.<span class="hljs-attribute">url</span>: ipa.shared.example.opentlc.<span class="hljs-attribute">com</span>:<span class="hljs-number">389</span>
    <span class="hljs-attribute">creationTimestamp</span>: <span class="hljs-literal">null</span>
    <span class="hljs-attribute">labels</span>:
      openshift.io/ldap.<span class="hljs-attribute">host</span>: ipa.shared.example.opentlc.com
    <span class="hljs-attribute">name</span>: portalapp
  <span class="hljs-attribute">users</span>:
  - andrew
  - portal1
  - portal2
  - chenzhen
[...]</code></pre></div></div></li></ol></div></div>
<div class="sect2"><h3 id="_synchronize_groups">4.5. Synchronize Groups</h3><div class="olist arabic"><ol class="arabic"><li><p>Run the same <code>oc adm groups sync</code> command, but add <code>--confirm</code> to create the groups:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs">oc adm groups sync --sync-config=/etc/origin/master/groupsync.yaml --whitelist=/etc/origin/master/whitelist.yaml --confirm</code></pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="highlight"><code class="text language-text hljs cs"><span class="hljs-keyword">group</span>/portalapp
<span class="hljs-keyword">group</span>/paymentapp
<span class="hljs-keyword">group</span>/ocp-production
<span class="hljs-keyword">group</span>/ocp-platform</code></pre></div></div></li><li><p>Verify that the groups are created:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs">oc get groups</code></pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="highlight"><code class="text language-text hljs nginx"><span class="hljs-title">NAME</span>             USERS
ocp-platform     david, admin1, admin2, luochen, loren, chenzhen
ocp-production   karla, prod1, prod2, luochen, loren, chenzhen
paymentapp       marina, payment1, payment2, chenzhen
portalapp        andrew, portal1, portal2, chenzhen</code></pre></div></div></li><li><p>Disconnect from the <code>master1</code> host, and return to the <code>bastion</code> host.</p></li></ol></div></div></div></div>
<div class="sect1"><h2 id="_post_installation_configuration">5. Post installation configuration</h2><div class="sectionbody"><div class="paragraph"><p>In this section, you create persistent volumes (PVs) for users to consume.</p></div>
<div class="ulist"><ul><li><p>Create 25 PVs with these parameters:</p><div class="ulist"><ul><li><p>Size: 5 GB</p></li><li><p>PV access: <code>ReadWriteOnce</code></p></li><li><p>ReclaimPolicy: <code>Recycle</code></p></li></ul></div></li><li><p>Create 25 PVs with these parameters:</p><div class="ulist"><ul><li><p>Size: 10 GB</p></li><li><p>PV access: <code>ReadWriteMany</code></p></li><li><p>ReclaimPolicy: <code>Retain</code></p></li></ul></div></li></ul></div>
<div class="sect2"><h3 id="_create_pvs_for_users">5.1. Create PVs for Users</h3><div class="olist arabic"><ol class="arabic"><li><p>Create directories on the <code>support1.$GUID.internal</code> NFS server to be used as PVs in
the OpenShift cluster. These directories should be under <code>/srv/nfs</code> because this directory is backed by a separate volume group.</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs"><span class="hljs-built_in">export</span> GUID=`hostname|awk -F. <span class="hljs-string">'{print $2}'</span>`
<span class="hljs-built_in">echo</span> <span class="hljs-string">"export GUID=<span class="hljs-variable">$GUID</span>"</span> &gt;&gt; ~/.bashrc
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$GUID</span>

ssh support1.<span class="hljs-variable">$GUID</span>.internal
sudo -i
mkdir -p /srv/nfs/user-vols/pv{<span class="hljs-number">1</span>..<span class="hljs-number">200</span>}

<span class="hljs-keyword">for</span> pvnum <span class="hljs-keyword">in</span> {<span class="hljs-number">1</span>..<span class="hljs-number">50</span>} ; <span class="hljs-keyword">do</span>
<span class="hljs-built_in">echo</span> /srv/nfs/user-vols/pv<span class="hljs-variable">${pvnum}</span> *(rw,root_squash) &gt;&gt; /etc/exports.d/openshift-uservols.exports
chown -R nfsnobody.nfsnobody  /srv/nfs
chmod -R <span class="hljs-number">777</span> /srv/nfs
<span class="hljs-keyword">done</span>

systemctl restart nfs-server
<span class="hljs-built_in">exit</span>
<span class="hljs-built_in">exit</span></code></pre></div></div></li><li><p>On your bastion create 25 definition files for PVs <code>pv1</code> to <code>pv25</code> with a size of 5 GB and <code>ReadWriteOnce</code> access mode.</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs"><span class="hljs-built_in">export</span> GUID=`hostname|awk -F. <span class="hljs-string">'{print $2}'</span>`

<span class="hljs-built_in">export</span> volsize=<span class="hljs-string">"5Gi"</span>
mkdir /root/pvs
<span class="hljs-keyword">for</span> volume <span class="hljs-keyword">in</span> pv{<span class="hljs-number">1</span>..<span class="hljs-number">25</span>} ; <span class="hljs-keyword">do</span>
cat &lt;&lt; EOF &gt; /root/pvs/<span class="hljs-variable">${volume}</span>
{
  <span class="hljs-string">"apiVersion"</span>: <span class="hljs-string">"v1"</span>,
  <span class="hljs-string">"kind"</span>: <span class="hljs-string">"PersistentVolume"</span>,
  <span class="hljs-string">"metadata"</span>: {
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"<span class="hljs-variable">${volume}</span>"</span>
  },
  <span class="hljs-string">"spec"</span>: {
    <span class="hljs-string">"capacity"</span>: {
        <span class="hljs-string">"storage"</span>: <span class="hljs-string">"<span class="hljs-variable">${volsize}</span>"</span>
    },
    <span class="hljs-string">"accessModes"</span>: [ <span class="hljs-string">"ReadWriteOnce"</span> ],
    <span class="hljs-string">"nfs"</span>: {
        <span class="hljs-string">"path"</span>: <span class="hljs-string">"/srv/nfs/user-vols/<span class="hljs-variable">${volume}</span>"</span>,
        <span class="hljs-string">"server"</span>: <span class="hljs-string">"support1.<span class="hljs-variable">${GUID}</span>.internal"</span>
    },
    <span class="hljs-string">"persistentVolumeReclaimPolicy"</span>: <span class="hljs-string">"Recycle"</span>
  }
}
EOF
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Created def file for <span class="hljs-variable">${volume}</span>"</span>;
<span class="hljs-keyword">done</span>;</code></pre></div></div></li><li><p>On your bastion create 25 definition files for PVs <code>pv26</code> to <code>pv50</code> with a size of 10 GB and <code>ReadWriteMany</code> access mode.</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs"><span class="hljs-built_in">export</span> GUID=`hostname|awk -F. <span class="hljs-string">'{print $2}'</span>`

<span class="hljs-built_in">export</span> volsize=<span class="hljs-string">"10Gi"</span>
<span class="hljs-keyword">for</span> volume <span class="hljs-keyword">in</span> pv{<span class="hljs-number">26</span>..<span class="hljs-number">50</span>} ; <span class="hljs-keyword">do</span>
cat &lt;&lt; EOF &gt; /root/pvs/<span class="hljs-variable">${volume}</span>
{
  <span class="hljs-string">"apiVersion"</span>: <span class="hljs-string">"v1"</span>,
  <span class="hljs-string">"kind"</span>: <span class="hljs-string">"PersistentVolume"</span>,
  <span class="hljs-string">"metadata"</span>: {
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"<span class="hljs-variable">${volume}</span>"</span>
  },
  <span class="hljs-string">"spec"</span>: {
    <span class="hljs-string">"capacity"</span>: {
        <span class="hljs-string">"storage"</span>: <span class="hljs-string">"<span class="hljs-variable">${volsize}</span>"</span>
    },
    <span class="hljs-string">"accessModes"</span>: [ <span class="hljs-string">"ReadWriteMany"</span> ],
    <span class="hljs-string">"nfs"</span>: {
        <span class="hljs-string">"path"</span>: <span class="hljs-string">"/srv/nfs/user-vols/<span class="hljs-variable">${volume}</span>"</span>,
        <span class="hljs-string">"server"</span>: <span class="hljs-string">"support1.<span class="hljs-variable">${GUID}</span>.internal"</span>
    },
    <span class="hljs-string">"persistentVolumeReclaimPolicy"</span>: <span class="hljs-string">"Retain"</span>
  }
}
EOF
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Created def file for <span class="hljs-variable">${volume}</span>"</span>;
<span class="hljs-keyword">done</span>;</code></pre></div></div></li><li><p>Use <code>oc create</code> to create all of the PVs you defined.</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs">cat /root/pvs/* | oc create <span class="hljs-operator">-f</span> -</code></pre></div></div></li><li><p>Double check your PVs.</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs">oc get pv</code></pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="highlight nowrap"><code class="text language-text hljs nginx"><span class="hljs-title">NAME</span>                             CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM                                       STORAGECLASS   REASON    AGE
etcd-asb-volume                  <span class="hljs-number">10G</span>        RWO            Retain           Bound       openshift-ansible-service-broker/etcd                                <span class="hljs-number">22m</span>
logging-volume                   10Gi       RWO            Retain           Bound       logging/logging-es-<span class="hljs-number">0</span>                                                 <span class="hljs-number">22m</span>
metrics-volume                   10Gi       RWO            Retain           Bound       openshift-infra/metrics-cassandra-<span class="hljs-number">1</span>                                  <span class="hljs-number">22m</span>
prometheus-alertbuffer-volume    10Gi       RWO            Retain           Bound       openshift-metrics/prometheus-alertbuffer                             <span class="hljs-number">22m</span>
prometheus-alertmanager-volume   10Gi       RWO            Retain           Bound       openshift-metrics/prometheus-alertmanager                            <span class="hljs-number">22m</span>
prometheus-volume                10Gi       RWO            Retain           Bound       openshift-metrics/prometheus                                         <span class="hljs-number">22m</span>
pv1                              5Gi        RWO            Recycle          Available                                                                        <span class="hljs-number">3s</span>
pv10                             5Gi        RWO            Recycle          Available                                                                        <span class="hljs-number">3s</span>
pv11                             5Gi        RWO            Recycle          Available                                                                        <span class="hljs-number">3s</span>
pv12                             5Gi        RWO            Recycle          Available                                                                        <span class="hljs-number">3s</span>
pv13                             5Gi        RWO            Recycle          Available                                                                        <span class="hljs-number">3s</span>

[...]</code></pre></div></div></li></ol></div></div>
<div class="sect2"><h3 id="_fix_nfs_persistent_volume_recycling">5.2. Fix NFS Persistent Volume Recycling</h3><div class="paragraph"><p>For persistent volumes with type <code>recycling</code> OpenShift does no longer provide the recycler pod automatically since it is deprecated. This pod however is needed to properly re-use persistent volumes.</p></div>
<div class="paragraph"><p>The container image still exists with tag <code>latest</code> in the Red Hat registry. It only needs to be pulled to all the nodes and made available for use by tagging the image with the exact version installed (note that the version can change in the future):</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs">ansible nodes -m shell <span class="hljs-operator">-a</span> <span class="hljs-string">"docker pull registry.access.redhat.com/openshift3/ose-recycler:latest"</span>
ansible nodes -m shell <span class="hljs-operator">-a</span> <span class="hljs-string">"docker tag registry.access.redhat.com/openshift3/ose-recycler:latest registry.access.redhat.com/openshift3/ose-recycler:v3.9.30"</span></code></pre></div></div></div></div></div>
<div class="sect1"><h2 id="_smoke_test">6. Smoke Test</h2><div class="sectionbody"><div class="paragraph"><p>In order to verify that your cluster is set up correctly it is always a good idea to execute a smoke test. This should verify that your PVs are working, you can build an application, the application image can be pushed to the registry, your pod will be running and the routers can route traffic to the application.</p></div>
<div class="paragraph"><p>A simple smoke test can be done using the <code>nodejs-mongo-persistent</code> template. This template creates a MongoDB database with persistent storage. It also builds a Node.JS application from source code and pushes it into the registry. Finally when the application is running the route can be used to validate that the routers are working correctly.</p></div>
<div class="paragraph"><p>Make sure to create a new project for this smoke test - it is generally a rather bad idea to deploy any applications into the <code>default</code> project on the OpenShift cluster.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Create a new project:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs">oc new-project smoke-test</code></pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="highlight"><code class="text language-text hljs coffeescript">Now using project <span class="hljs-string">"smoke-test"</span> <span class="hljs-literal">on</span> server <span class="hljs-string">"https://loadbalancer1.GUID.internal:443"</span>.

You can add applications to <span class="hljs-keyword">this</span> project <span class="hljs-reserved">with</span> the <span class="hljs-string">'new-app'</span> command. For example, <span class="hljs-attribute">try</span>:

    oc <span class="hljs-keyword">new</span>-app centos<span class="hljs-regexp">/ruby-22-centos7~https:/</span>/github.com/openshift/ruby-ex.git

to build a <span class="hljs-keyword">new</span> example application <span class="hljs-keyword">in</span> Ruby.</code></pre></div></div></li><li><p>Create the Node.JS Application:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs">oc new-app nodejs-mongo-persistent</code></pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="highlight"><code class="text language-text hljs cs">--&gt; Deploying template <span class="hljs-string">"openshift/nodejs-mongo-persistent"</span> to project smoke-test

     Node.js + MongoDB
     ---------
     An example Node.js application with a MongoDB database. For more information about <span class="hljs-keyword">using</span> <span class="hljs-keyword">this</span> template, including OpenShift considerations, see https:<span class="hljs-comment">//github.com/openshift/nodejs-ex/blob/master/README.md.</span>

     <span class="hljs-function">The following <span class="hljs-title">service</span><span class="hljs-params">(s)</span> have been created <span class="hljs-keyword">in</span> your project: nodejs-mongo-persistent, mongodb.

     For more information about <span class="hljs-keyword">using</span> <span class="hljs-keyword">this</span> template, including OpenShift considerations, see https:<span class="hljs-comment">//github.com/openshift/nodejs-ex/blob/master/README.md.</span>

     * With parameters:
        * Name</span>=nodejs-mongo-persistent
        * Namespace=openshift
        * Memory Limit=<span class="hljs-number">512</span>Mi
        * <span class="hljs-function">Memory <span class="hljs-title">Limit</span> <span class="hljs-params">(MongoDB)</span></span>=<span class="hljs-number">512</span>Mi
        * Volume Capacity=<span class="hljs-number">1</span>Gi
        * Git Repository URL=https:<span class="hljs-comment">//github.com/openshift/nodejs-ex.git</span>
        * Git Reference=
        * Context Directory=
        * Application Hostname=
        * GitHub Webhook Secret=XdnlCWtW1p1KkBJBHwQMftofg1QUvWwvJtwIyvYf <span class="hljs-preprocessor"># generated</span>
        * Generic Webhook Secret=t1gQT4xLApVDiGqmTLin6cXUapGP5TDG6OIXATBq <span class="hljs-preprocessor"># generated</span>
        * Database Service Name=mongodb
        * MongoDB Username=user5UB <span class="hljs-preprocessor"># generated</span>
        * MongoDB Password=<span class="hljs-number">8</span>RjsBR14VKpWrWeb <span class="hljs-preprocessor"># generated</span>
        * Database Name=sampledb
        * Database Administrator Password=<span class="hljs-number">7</span>sxiK0lJNTN0rkmM <span class="hljs-preprocessor"># generated</span>
        * Custom NPM Mirror URL=

--&gt; Creating resources ...
    secret <span class="hljs-string">"nodejs-mongo-persistent"</span> created
    service <span class="hljs-string">"nodejs-mongo-persistent"</span> created
    route <span class="hljs-string">"nodejs-mongo-persistent"</span> created
    imagestream <span class="hljs-string">"nodejs-mongo-persistent"</span> created
    buildconfig <span class="hljs-string">"nodejs-mongo-persistent"</span> created
    deploymentconfig <span class="hljs-string">"nodejs-mongo-persistent"</span> created
    persistentvolumeclaim <span class="hljs-string">"mongodb"</span> created
    service <span class="hljs-string">"mongodb"</span> created
    deploymentconfig <span class="hljs-string">"mongodb"</span> created
--&gt; Success
    Access your application via route <span class="hljs-string">'nodejs-mongo-persistent-smoke-test.apps.GUID.example.opentlc.com'</span>
    Build scheduled, use <span class="hljs-string">'oc logs -f bc/nodejs-mongo-persistent'</span> to track its progress.
    Run <span class="hljs-string">'oc status'</span> to view your app.</code></pre></div></div></li><li><p>Watch the build and mongo pods:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs">watch oc get pod</code></pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="highlight"><code class="text language-text hljs cs">Every <span class="hljs-number">2.0</span>s: oc <span class="hljs-keyword">get</span> pod                                                                                                                                                                                               Wed Apr <span class="hljs-number">18</span> <span class="hljs-number">16</span>:<span class="hljs-number">08</span>:<span class="hljs-number">29</span> <span class="hljs-number">2018</span>

NAME                              READY     STATUS    RESTARTS   AGE
mongodb-<span class="hljs-number">1</span>-deploy                  <span class="hljs-number">1</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">0</span>          <span class="hljs-number">41</span>s
mongodb-<span class="hljs-number">1</span>-dx2kx                   <span class="hljs-number">0</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">0</span>          <span class="hljs-number">38</span>s
nodejs-mongo-persistent-<span class="hljs-number">1</span>-build   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>       Running   <span class="hljs-number">0</span>          <span class="hljs-number">43</span>s</code></pre></div></div></li><li><p>When the build has finished and both the <code>mongodb</code> as well as the <code>nodejs-mongo-persistent</code> pod are running (showing <strong>1/1</strong> in the <code>READY</code> column) retrieve the route:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs">oc get route</code></pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="highlight"><code class="text language-text hljs apache"><span class="hljs-keyword">NAME</span>                      HOST/PORT                                                          PATH      SERVICES                  PORT      TERMINATION   WILDCARD
<span class="hljs-keyword">nodejs</span>-mongo-persistent   nodejs-mongo-persistent-smoke-test.apps.GUID.example.opentlc.com             nodejs-mongo-persistent   &lt;<span class="hljs-literal">all</span>&gt;                   None</code></pre></div></div></li><li><p>In a web browser navigate to the route (replacing <strong>GUID</strong> with your specific GUID). Your application should be running and showing a database connection at the bottom right of the page.</p></li><li><p>Delete your smoke test project:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs">oc delete project smoke-test</code></pre></div></div></li></ol></div>
<div class="paragraph"><p>You can be reasonably certain that most aspects of your cluster work satisfactory.</p></div></div></div></div><div id="footer"><div id="footer-text"><br>Build Version: a6664962b240b13acb6b617e5e7545bb2908bf7c   :   Last updated 2018-07-09 18:27:15 EDT</div></div></body><div id="cVim-status-bar" style="top: 0px;"></div><iframe src="./HA Deployment Lab_files/cmdline_frame.html" id="cVim-command-frame"></iframe></html>