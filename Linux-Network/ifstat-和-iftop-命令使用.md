## ifstat 和 iftop 命令使用

###ifstat介绍

>ifstat工具是个网络接口监测工具,比较简单看网络流量

 

##实例

###默认使用

    #ifstat
           eth0                eth1       
     KB/s in  KB/s out   KB/s in  KB/s out
        0.07      0.20      0.00      0.00
        0.07      0.15      0.58      0.00
    默认ifstat不监控回环接口，显示的流量单位是KB。

 

###监控所有网络接口

    # ifstat -a
            lo                 eth0                eth1       
     KB/s in  KB/s out   KB/s in  KB/s out   KB/s in  KB/s out
        0.00      0.00      0.28      0.58      0.06      0.06
        0.00      0.00      1.41      1.13      0.00      0.00
        0.61      0.61      0.26      0.23      0.00      0.00
     

>ifstat比较简单看网络流量概况。

 

##iftop介绍

>iftop是一款实时流量监控工具,监控TCP/IP连接等,缺点就是无报表功能。必须以root身份才能运行。

 

###实例

    默认是监控第一块网卡的流量

    iftop
    监控eth1

    iftop -i eth1
    直接显示IP, 不进行DNS反解析

    iftop -n
    直接显示连接埠编号, 不显示服务名称:

    iftop -N
    显示某个网段进出封包流量

    iftop -F 192.168.1.0/24 or 192.168.1.0/255.255.255.0
     

###基于实例讲解输出含义

    执行iftop -N -n -i eth1后界面为


                     19.1Mb            38.1Mb              57.2Mb               76.3Mb             95.4Mb
    +-----------------+-----------------+--------------------+--------------------+---------------------
    192.168.1.11                                  => 192.168.1.66                  5.3Mb  3.22Mb  3.20Mb
                                                  <=                               219kb  45.7kb  49.3kb
    192.168.1.11                                   => 192.168.1.29                 144kb  30.8kb  29.6kb
                                                  <=                               11.3Mb  2.38Mb  2.74Mb
    192.168.1.11                                  => 12.2.11.71                    0b   6.40kb  6.66kb
                                                  <=                               0b      0b      0b
    192.168.1.11                                  => 192.168.1.8                   2.63kb  1.43kb   932b
                                                  <=                               1.31kb  1.05kb   893b
    192.168.1.11                                   => 192.168.2.78                 2.53kb  1.54kb  2.15kb
                                                   <=                              160b    160b    187b
    192.168.1.11                                   => 111.126.195.69               0b    166b     69b
                                                   <=                              0b      0b      0b
    ------------------------------------------------------------------------------------------------------
    TX:             cum:   9.70MB   peak:   15.6Mb                          rates:   15.4Mb  3.26Mb  3.23Mb
    RX:                    8.38MB           14.9Mb                                   11.5Mb  2.42Mb  2.79Mb
    TOTAL:                 18.1MB           30.5Mb                                   27.0Mb  5.69Mb  6.03Mb

###iftop界面含义如下


    第一行：带宽显示

    中间部分：外部连接列表，即记录了哪些ip正在和本机的网络连接

    中间部分右边：实时参数分别是该访问ip连接到本机2秒，10秒和40秒的平均流量

    =>代表发送数据，<= 代表接收数据

    底部三行：表示发送，接收和全部的流量

    底部三行第二列：为你运行iftop到目前流量

    底部三行第三列：为高峰值

    底部三行第四列：为平均值

>通过iftop的界面很容易找到哪个ip在霸占网络流量，这个是ifstat做不到的。不过iftop的流量显示单位是Mb,这个b是bit，是位，不是字节，而ifstat的KB，这个B就是字节了，byte是bit的8倍。初学者容易被误导。

 

###进入iftop的命令


    进入iftop画面后的一些操作命令(注意大小写)

    按h切换是否显示帮助;

    按n切换显示本机的IP或主机名;

    按s切换是否显示本机的host信息;

    按d切换是否显示远端目标主机的host信息;

    按t切换显示格式为2行/1行/只显示发送流量/只显示接收流量;

    按N切换显示端口号或端口服务名称;

    按S切换是否显示本机的端口信息;

    按D切换是否显示远端目标主机的端口信息;

    按p切换是否显示端口信息;

    按P切换暂停/继续显示;

    按b切换是否显示平均流量图形条;

    按B切换计算2秒或10秒或40秒内的平均流量;

    按T切换是否显示每个连接的总流量;

    按l打开屏幕过滤功能，输入要过滤的字符，比如ip,按回车后，屏幕就只显示这个IP相关的流量信息;

    按L切换显示画面上边的刻度;刻度不同，流量图形条会有变化;

    按j或按k可以向上或向下滚动屏幕显示的连接记录;

    按1或2或3可以根据右侧显示的三列流量数据进行排序;

    按<根据左边的本机名或IP排序;

    按>根据远端目标主机的主机名或IP排序;

    按o切换是否固定只显示当前的连接;

    按f可以编辑过滤代码，这是翻译过来的说法，我还没用过这个！

    按!可以使用shell命令，这个没用过！没搞明白啥命令在这好用呢！

    按q退出监控。
